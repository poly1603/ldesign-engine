# 快速开始

<cite>
**本文档中引用的文件**
- [packages/vue3/package.json](file://packages/vue3/package.json)
- [packages/vue3/README.md](file://packages/vue3/README.md)
- [packages/vue3/builder.config.ts](file://packages/vue3/builder.config.ts)
- [packages/vue3/src/index.ts](file://packages/vue3/src/index.ts)
- [packages/vue3/src/engine/vue-engine.ts](file://packages/vue3/src/engine/vue-engine.ts)
- [packages/vue3/src/plugins/index.ts](file://packages/vue3/src/plugins/index.ts)
- [packages/vue3/src/plugins/router-plugin.ts](file://packages/vue3/src/plugins/router-plugin.ts)
- [packages/vue3/src/plugins/i18n-plugin.ts](file://packages/vue3/src/plugins/i18n-plugin.ts)
- [packages/vue3/src/composables/index.ts](file://packages/vue3/src/composables/index.ts)
- [packages/vue3/src/composables/use-engine.ts](file://packages/vue3/src/composables/use-engine.ts)
- [packages/vue3/src/composables/use-router.ts](file://packages/vue3/src/composables/use-router.ts)
- [packages/vue3/example/src/main.ts](file://packages/vue3/example/src/main.ts)
- [packages/vue3/example/README.md](file://packages/vue3/example/README.md)
- [packages/vue3/example/package.json](file://packages/vue3/example/package.json)
- [packages/core/package.json](file://packages/core/package.json)
</cite>

## 目录
1. [简介](#简介)
2. [环境要求](#环境要求)
3. [安装依赖](#安装依赖)
4. [初始化引擎实例](#初始化引擎实例)
5. [注册基础插件和中间件](#注册基础插件和中间件)
6. [挂载应用](#挂载应用)
7. [最小可运行示例](#最小可运行示例)
8. [builder.config.ts 配置文件](#builderconfigts-配置文件)
9. [运行演示项目](#运行演示项目)
10. [常见初始化错误及解决方案](#常见初始化错误及解决方案)
11. [总结](#总结)

## 简介

LDesign Engine 是一个基于 Vue 3 的强大应用引擎框架，提供了统一的插件系统、中间件机制、状态管理和事件系统。本指南将帮助您在 5 分钟内完成首次集成并看到效果。

## 环境要求

在开始之前，请确保您的开发环境满足以下要求：
- Node.js 版本 ≥ 16.x
- pnpm 包管理器
- Vue 3.3.0 或更高版本
- TypeScript 5.0 或更高版本（推荐）

## 安装依赖

### 1. 安装核心包

```bash
pnpm add @ldesign/engine-vue3 vue@^3.5.0
```

### 2. 可选依赖（根据需要安装）

```bash
# 路由支持
pnpm add @ldesign/router-vue

# 国际化支持  
pnpm add @ldesign/i18n-vue
```

**节来源**
- [packages/vue3/package.json](file://packages/vue3/package.json#L68-L92)

## 初始化引擎实例

### 基本初始化

```typescript
import { createEngineApp } from '@ldesign/engine-vue3'
import App from './App.vue'

const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  config: {
    name: '我的 Vue 3 应用',
    debug: true,
  },
})
```

### 高级配置选项

```typescript
const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  config: {
    name: '高级配置应用',
    version: '1.0.0',
    debug: true,
    environment: 'development',
  },
  // 应用配置
  app: {
    rootComponent: App,
    globalProperties: {
      $api: apiService,
    },
    globalComponents: {
      MyButton: ButtonComponent,
    },
  },
})
```

**节来源**
- [packages/vue3/README.md](file://packages/vue3/README.md#L13-L25)
- [packages/vue3/src/engine/vue-engine.ts](file://packages/vue3/src/engine/vue-engine.ts#L25-L41)

## 注册基础插件和中间件

### 创建自定义插件

```typescript
import { definePlugin } from '@ldesign/engine-vue3'

const loggerPlugin = definePlugin({
  name: 'logger',
  version: '1.0.0',
  install(context) {
    console.log('Logger 插件已安装')
    
    // 监听所有事件
    context.engine.events.on('*', (event, data) => {
      console.log(`事件触发: ${event}`, data)
    })
  },
})

const themePlugin = definePlugin({
  name: 'theme',
  version: '1.0.0',
  install(context) {
    console.log('Theme 插件已安装')
    context.engine.state.set('theme', 'light')
  },
})
```

### 创建中间件

```typescript
import { defineMiddleware } from '@ldesign/engine-vue3'

const authMiddleware = defineMiddleware({
  name: 'auth',
  priority: 100,
  async execute(context, next) {
    console.log('认证中间件: 执行前')
    await next()
    console.log('认证中间件: 执行后')
  },
})

const loggingMiddleware = defineMiddleware({
  name: 'logging',
  priority: 50,
  async execute(context, next) {
    console.log('日志中间件: 执行前', context.data)
    await next()
    console.log('日志中间件: 执行后')
  },
})
```

### 在引擎中注册

```typescript
const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  plugins: [loggerPlugin, themePlugin],
  middleware: [authMiddleware, loggingMiddleware],
})
```

**节来源**
- [packages/vue3/README.md](file://packages/vue3/README.md#L29-L67)
- [packages/vue3/example/src/main.ts](file://packages/vue3/example/src/main.ts#L14-L58)

## 挂载应用

### 基本挂载

```typescript
// 引擎创建后自动挂载
const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  // ...其他配置
})

// 或者手动挂载
await engine.mount('#app')
```

### 生命周期回调

```typescript
const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  onReady: async (engine) => {
    console.log('引擎准备就绪!')
    engine.state.set('appName', '我的应用')
  },
  onMounted: async (engine) => {
    console.log('应用已挂载!')
    engine.events.emit('app:mounted')
  },
  onError: (error, context) => {
    console.error('发生错误:', error, context)
  },
})
```

**节来源**
- [packages/vue3/src/engine/vue-engine.ts](file://packages/vue3/src/engine/vue-engine.ts#L186-L247)

## 最小可运行示例

### 项目结构

```
my-vue3-app/
├── src/
│   ├── App.vue
│   ├── main.ts
│   └── components/
│       └── Counter.vue
├── index.html
├── package.json
└── tsconfig.json
```

### main.ts - 入口文件

```typescript
import { createEngineApp } from '@ldesign/engine-vue3'
import App from './App.vue'

// 创建引擎应用
const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
  config: {
    name: '计数器应用',
    debug: true,
  },
  onReady: async (engine) => {
    // 设置初始状态
    engine.state.set('count', 0)
    
    // 触发欢迎事件
    engine.events.emit('app:ready', { message: '应用已启动' })
  },
  onMounted: async (engine) => {
    console.log('应用已成功挂载!')
  },
})
```

### App.vue - 主应用组件

```vue
<template>
  <div class="app">
    <h1>{{ appName }}</h1>
    <p>当前计数: {{ count }}</p>
    <button @click="increment">增加</button>
    <button @click="decrement">减少</button>
  </div>
</template>

<script setup>
import { useEngine, useState, useEvent } from '@ldesign/engine-vue3'

const engine = useEngine()
const appName = useState('appName', '我的应用')
const count = useState('count', 0)

// 监听事件
useEvent('app:ready', (data) => {
  console.log(data.message)
})

// 方法
const increment = () => {
  const newCount = count.value + 1
  engine.state.set('count', newCount)
  engine.events.emit('count:changed', newCount)
}

const decrement = () => {
  const newCount = count.value - 1
  engine.state.set('count', newCount)
  engine.events.emit('count:changed', newCount)
}
</script>
```

### package.json

```json
{
  "name": "my-vue3-app",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.5.0",
    "@ldesign/engine-vue3": "^0.3.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "typescript": "^5.0.0",
    "vite": "^5.0.0"
  }
}
```

**节来源**
- [packages/vue3/example/src/main.ts](file://packages/vue3/example/src/main.ts#L60-L134)

## builder.config.ts 配置文件

### 基本配置结构

```typescript
import { defineConfig } from '@ldesign/builder'

export default defineConfig({
  output: {
    esm: {
      dir: 'es',
      preserveModules: true,
      preserveModulesRoot: 'src',
    },
    cjs: {
      dir: 'lib',
      preserveModules: true,
      preserveModulesRoot: 'src',
    },
    umd: {
      enabled: true,
      name: 'LDesignEngineVue3',
      input: 'src/index.ts',
      minify: true,
    },
  },
  external: [
    '@ldesign/engine-core',
    'vue',
    '@ldesign/router-vue',
    '@ldesign/i18n-vue',
  ],
})
```

### 配置说明

| 配置项 | 类型 | 说明 |
|--------|------|------|
| `output.esm.dir` | string | ESM 输出目录 |
| `output.cjs.dir` | string | CommonJS 输出目录 |
| `output.umd.enabled` | boolean | 是否生成 UMD 版本 |
| `output.umd.name` | string | UMD 包名 |
| `external` | string[] | 外部依赖列表 |

**节来源**
- [packages/vue3/builder.config.ts](file://packages/vue3/builder.config.ts#L1-L33)

## 运行演示项目

### 1. 克隆仓库

```bash
git clone https://github.com/your-repository.git
cd packages/engine/packages/vue3
```

### 2. 安装依赖

```bash
pnpm install
```

### 3. 启动开发服务器

```bash
pnpm dev
```

### 4. 访问应用

打开浏览器访问 `http://localhost:3000` 查看演示效果。

### 5. 构建生产版本

```bash
pnpm build
```

### 6. 预览构建结果

```bash
pnpm preview
```

**节来源**
- [packages/vue3/example/README.md](file://packages/vue3/example/README.md#L37-L62)
- [packages/vue3/example/package.json](file://packages/vue3/example/package.json#L7-L19)

## 常见初始化错误及解决方案

### 1. 依赖缺失错误

**错误信息：**
```
Module not found: Error: Can't resolve '@ldesign/engine-vue3'
```

**解决方案：**
```bash
# 确保安装了正确的包
pnpm add @ldesign/engine-vue3 vue@^3.5.0

# 检查 package.json 中的版本匹配
```

### 2. Vue 版本不兼容

**错误信息：**
```
Vue version mismatch: expected ^3.3.0 || ^3.4.0 || ^3.5.0
```

**解决方案：**
```bash
# 升级 Vue 版本
pnpm add vue@^3.5.0

# 或者安装兼容版本
pnpm add vue@^3.3.0
```

### 3. 引擎未正确初始化

**错误信息：**
```
Engine not found. Make sure the app is created with VueEngine.
```

**解决方案：**
```typescript
// 确保使用 createEngineApp 而不是直接使用 Vue.createApp
import { createEngineApp } from '@ldesign/engine-vue3'

const engine = await createEngineApp({
  rootComponent: App,
  mountElement: '#app',
})
```

### 4. 插件安装失败

**错误信息：**
```
Plugin installation failed: missing dependencies
```

**解决方案：**
```typescript
// 检查插件依赖
const myPlugin = definePlugin({
  name: 'my-plugin',
  version: '1.0.0',
  dependencies: ['@ldesign/some-dependency'], // 添加必要的依赖
  install(context) {
    // 插件逻辑
  },
})
```

### 5. 中间件执行异常

**错误信息：**
```
Middleware execution failed: next() not called
```

**解决方案：**
```typescript
const middleware = defineMiddleware({
  name: 'safe-middleware',
  async execute(context, next) {
    try {
      await next() // 确保始终调用 next()
    } catch (error) {
      console.error('中间件错误:', error)
      // 可以选择继续执行或终止
      await next()
    }
  },
})
```

### 6. 状态更新问题

**错误信息：**
```
State update failed: invalid key
```

**解决方案：**
```typescript
// 使用有效的状态键
engine.state.set('valid_key_name', value)
engine.state.set('another_valid_key', anotherValue)

// 避免使用特殊字符作为键名
// ❌ engine.state.set('invalid-key!', value)
```

### 7. 事件监听器泄漏

**错误信息：**
```
Memory leak detected: event listeners not cleaned up
```

**解决方案：**
```typescript
// 使用组合式 API 自动清理
import { useEvent } from '@ldesign/engine-vue3'

export default {
  setup() {
    // useEvent 会自动清理监听器
    useEvent('some-event', (data) => {
      console.log('事件处理:', data)
    })
  },
}
```

## 总结

通过本快速入门指南，您已经学会了：

1. **安装依赖** - 正确安装和配置 @ldesign/engine-vue3
2. **初始化引擎** - 创建和配置 Vue3 引擎实例
3. **注册插件** - 创建和使用自定义插件系统
4. **配置中间件** - 实现请求拦截和处理逻辑
5. **挂载应用** - 完成应用的初始化和渲染
6. **使用组合式 API** - 通过 Vue 3 的 Composition API 访问引擎功能
7. **运行示例** - 通过演示项目学习最佳实践

现在您可以开始在自己的 Vue 3 项目中集成 LDesign Engine，享受其提供的强大功能和灵活性。建议从简单的状态管理和事件系统开始，逐步探索插件和中间件系统的高级特性。

**节来源**
- [packages/vue3/README.md](file://packages/vue3/README.md#L1-L219)