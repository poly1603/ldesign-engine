# Engine åŒ… P1 æµ‹è¯•ä½“ç³»å»ºè®¾è¿›åº¦

**å¼€å§‹æ—¶é—´**: 2025-11-24  
**é¢„è®¡å®Œæˆ**: 2025-12-22 (4 å‘¨)  
**å½“å‰çŠ¶æ€**: Week 1 - Day 1 è¿›è¡Œä¸­

---

## ğŸ“Š æ€»ä½“è¿›åº¦

| é˜¶æ®µ | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|------|--------|
| **Week 1** | æµ‹è¯•åŸºç¡€è®¾æ–½ + ç‹¬ç«‹æ¨¡å—æµ‹è¯• | ğŸ”„ è¿›è¡Œä¸­ | 20% |
| **Week 2** | æ›´å¤šæ¨¡å—æµ‹è¯• + è¾¹ç•Œåœºæ™¯ | â³ å¾…å¼€å§‹ | 0% |
| **Week 3** | é›†æˆæµ‹è¯• + æ€§èƒ½æµ‹è¯• | â³ å¾…å¼€å§‹ | 0% |
| **Week 4** | CI é…ç½® + æ–‡æ¡£ | â³ å¾…å¼€å§‹ | 0% |

**æ€»ä½“å®Œæˆåº¦**: 5%

---

## âœ… Week 1: æµ‹è¯•åŸºç¡€è®¾æ–½å’Œç‹¬ç«‹æ¨¡å—æµ‹è¯•

### Day 1-2: æµ‹è¯•åŸºç¡€è®¾æ–½ (è¿›è¡Œä¸­)

**ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„æµ‹è¯•åŸºç¡€è®¾æ–½

- [x] å®‰è£… @vitest/coverage-v8 ä¾èµ–
- [x] å‡çº§ vitest åˆ° 4.x ç‰ˆæœ¬
- [x] éªŒè¯æµ‹è¯•è¿è¡Œ (25/25 é€šè¿‡)
- [x] åˆ›å»º tests/setup.ts é…ç½®æ–‡ä»¶
- [x] åˆ›å»º tests/test-utils.ts å·¥å…·å‡½æ•°
  - [x] createTestPlugin - åˆ›å»ºæµ‹è¯•æ’ä»¶
  - [x] createTestMiddleware - åˆ›å»ºæµ‹è¯•ä¸­é—´ä»¶
  - [x] delay - å»¶è¿Ÿå‡½æ•°
  - [x] createSpy - åˆ›å»º spy å‡½æ•°
  - [x] createAsyncSpy - åˆ›å»ºå¼‚æ­¥ spy
  - [x] expectCalled - æ–­è¨€è°ƒç”¨æ¬¡æ•°
- [ ] ä¿®å¤è¦†ç›–ç‡é…ç½® (å½“å‰æ˜¾ç¤º 0%)
- [ ] åˆ›å»º mock å·¥å‚å‡½æ•°
- [ ] éªŒè¯è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ

**å½“å‰é—®é¢˜**:
- âš ï¸ è¦†ç›–ç‡æ˜¾ç¤º 0% - éœ€è¦è°ƒæ•´ vitest.config.ts çš„ exclude é…ç½®
- âš ï¸ EventManager æœ‰é‡å¤çš„ listenerCount æˆå‘˜è­¦å‘Š

### Day 3-5: ç‹¬ç«‹æ¨¡å—æµ‹è¯• (å¾…å¼€å§‹)

**ç›®æ ‡**: ä¸ºæ ¸å¿ƒæ¨¡å—ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•

- [ ] **PluginManager å•å…ƒæµ‹è¯•** (plugin-manager.test.ts)
  - [ ] æ’ä»¶æ³¨å†Œ/å¸è½½
  - [ ] ä¾èµ–æ£€æŸ¥
  - [ ] ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - [ ] é”™è¯¯å¤„ç†
  - [ ] æ’ä»¶çŠ¶æ€ç®¡ç†
  - [ ] æ’ä»¶ API æ³¨å†Œ

- [ ] **EventManager å•å…ƒæµ‹è¯•** (event-manager.test.ts)
  - [ ] äº‹ä»¶ç›‘å¬/è§¦å‘
  - [ ] ä¸€æ¬¡æ€§ç›‘å¬
  - [ ] ç›‘å¬å™¨ç§»é™¤
  - [ ] å†…å­˜æ³„æ¼æ£€æµ‹
  - [ ] é€šé…ç¬¦äº‹ä»¶
  - [ ] äº‹ä»¶ä¼˜å…ˆçº§

- [ ] **StateManager å•å…ƒæµ‹è¯•** (state-manager.test.ts)
  - [ ] çŠ¶æ€è®¾ç½®/è·å–
  - [ ] çŠ¶æ€ç›‘å¬
  - [ ] æ‰¹é‡æ“ä½œ
  - [ ] æ€§èƒ½æµ‹è¯•
  - [ ] çŠ¶æ€æŒä¹…åŒ–
  - [ ] çŠ¶æ€å¿«ç…§

---

## â³ Week 2: æ›´å¤šæ¨¡å—æµ‹è¯•å’Œè¾¹ç•Œåœºæ™¯ (å¾…å¼€å§‹)

### Day 1-3: å‰©ä½™æ¨¡å—æµ‹è¯•

- [ ] **MiddlewareManager å•å…ƒæµ‹è¯•** (middleware-manager.test.ts)
- [ ] **LifecycleManager å•å…ƒæµ‹è¯•** (lifecycle-manager.test.ts)
- [ ] **ConfigManager å•å…ƒæµ‹è¯•** (config-manager.test.ts)
- [ ] **ServiceContainer å•å…ƒæµ‹è¯•** (service-container.test.ts)

### Day 4-5: è¾¹ç•Œåœºæ™¯æµ‹è¯•

- [ ] **é”™è¯¯å¤„ç†æµ‹è¯•** (error-handling.test.ts)
- [ ] **å¹¶å‘æµ‹è¯•** (concurrency.test.ts)
- [ ] **å†…å­˜æ³„æ¼æµ‹è¯•** (memory-leak.test.ts)

---

## â³ Week 3: é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯• (å¾…å¼€å§‹)

### Day 1-3: é›†æˆæµ‹è¯•

- [ ] **å¤šæ’ä»¶åä½œæµ‹è¯•** (integration/multi-plugin.test.ts)
- [ ] **å¤æ‚ä¸­é—´ä»¶é“¾æµ‹è¯•** (integration/middleware-chain.test.ts)
- [ ] **å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµ‹è¯•** (integration/full-lifecycle.test.ts)

### Day 4-5: æ€§èƒ½æµ‹è¯•

- [ ] **å¤§é‡æ’ä»¶æ€§èƒ½æµ‹è¯•** (performance/plugin-load.bench.ts)
- [ ] **é«˜é¢‘äº‹ä»¶æ€§èƒ½æµ‹è¯•** (performance/event-throughput.bench.ts)
- [ ] **çŠ¶æ€æ›´æ–°æ€§èƒ½æµ‹è¯•** (performance/state-update.bench.ts)

---

## â³ Week 4: CI é…ç½®å’Œæ–‡æ¡£ (å¾…å¼€å§‹)

### Day 1-2: CI é…ç½®

- [ ] é…ç½® GitHub Actions æµ‹è¯•å·¥ä½œæµ
- [ ] é…ç½®è¦†ç›–ç‡ä¸Šä¼  (Codecov)
- [ ] é…ç½®æµ‹è¯•å¤±è´¥é€šçŸ¥
- [ ] é…ç½®æ€§èƒ½å›å½’æ£€æµ‹

### Day 3-5: æ–‡æ¡£å’Œæ€»ç»“

- [ ] ç¼–å†™æµ‹è¯•æŒ‡å— (TESTING.md)
- [ ] æ›´æ–° README æ·»åŠ æµ‹è¯•å¾½ç« 
- [ ] ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- [ ] ç¼–å†™æµ‹è¯•å®ŒæˆæŠ¥å‘Š

---

## ğŸ“ˆ æˆåŠŸæ ‡å‡†

- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] æ‰€æœ‰æ ¸å¿ƒæ¨¡å—éƒ½æœ‰ç‹¬ç«‹æµ‹è¯•
- [ ] æ‰€æœ‰è¾¹ç•Œåœºæ™¯éƒ½æœ‰æµ‹è¯•
- [ ] CI è‡ªåŠ¨åŒ–æµ‹è¯•å°±ç»ª
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºç«‹
- [ ] æ–‡æ¡£å®Œæ•´

---

## ğŸ› å·²çŸ¥é—®é¢˜

1. **è¦†ç›–ç‡æ˜¾ç¤º 0%**
   - åŸå› : vitest.config.ts çš„ exclude é…ç½®è¿‡äºå®½æ³›
   - è§£å†³æ–¹æ¡ˆ: è°ƒæ•´ exclude è§„åˆ™,åªæ’é™¤æµ‹è¯•æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶

2. **EventManager é‡å¤æˆå‘˜è­¦å‘Š**
   - ä½ç½®: packages/core/src/event/event-manager.ts:496
   - åŸå› : listenerCount æ–¹æ³•å®šä¹‰é‡å¤
   - è§£å†³æ–¹æ¡ˆ: ç§»é™¤é‡å¤çš„æ–¹æ³•å®šä¹‰

---

## ğŸ“ æ¯æ—¥æ›´æ–°

### 2025-11-24

**å®Œæˆ**:
- âœ… å®‰è£… @vitest/coverage-v8 4.0.13
- âœ… å‡çº§ vitest åˆ° 4.0.13
- âœ… å‡çº§ @vitest/ui åˆ° 4.0.13
- âœ… åˆ›å»º tests/setup.ts
- âœ… åˆ›å»º tests/test-utils.ts (150 è¡Œ)
- âœ… éªŒè¯æµ‹è¯•è¿è¡Œ: 25/25 é€šè¿‡ âœ…
- âœ… ä¿®å¤ EventManager é‡å¤æˆå‘˜è­¦å‘Š
- âš ï¸ è¦†ç›–ç‡é…ç½®é—®é¢˜ - ä»åœ¨è°ƒè¯•ä¸­

**è¦†ç›–ç‡é—®é¢˜è°ƒè¯•è®°å½•**:
1. å°è¯•æ·»åŠ  coverage.include é…ç½® - æ— æ•ˆ
2. å°è¯•ç§»é™¤ include,åªä½¿ç”¨ exclude - æ— æ•ˆ
3. å°è¯•æ·»åŠ  coverage.all - ä¸æ”¯æŒ
4. å°è¯•ç®€åŒ–é…ç½®,ç§»é™¤ global - æ— æ•ˆ
5. æ£€æŸ¥ coverage-final.json - ä¸ºç©ºå¯¹è±¡ {}
6. å‘ç° router åŒ…ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜

**å½“å‰çŠ¶æ€**:
- æµ‹è¯•é€šè¿‡ç‡: 100% (25/25) âœ…
- è¦†ç›–ç‡: 0% (é…ç½®é—®é¢˜) âŒ
- éœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥ vitest 4.x çš„è¦†ç›–ç‡é…ç½®

**ä¸‹ä¸€æ­¥**:
- åˆ›å»ºç®€å•æµ‹è¯•éªŒè¯è¦†ç›–ç‡æœºåˆ¶
- æˆ–æš‚æ—¶é™ä½è¦†ç›–ç‡é—¨æ§›,ç»§ç»­ç¼–å†™æµ‹è¯•
- å¼€å§‹ç¼–å†™ PluginManager å•å…ƒæµ‹è¯•

---

**æ–‡æ¡£ç»´æŠ¤**: æ¯æ—¥æ›´æ–°è¿›åº¦  
**ä¸‹æ¬¡è¯„å®¡**: 2025-11-25

