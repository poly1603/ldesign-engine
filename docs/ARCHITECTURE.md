# @ldesign/engine æ¶æ„æ–‡æ¡£

## ğŸ“ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vue Application                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Engine Core                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Config  â”‚  â”‚  Logger  â”‚  â”‚   Life   â”‚  â”‚   Env    â”‚   â”‚
â”‚  â”‚ Manager  â”‚  â”‚          â”‚  â”‚  Cycle   â”‚  â”‚ Manager  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Immediate   â”‚          â”‚  Lazy Load   â”‚
â”‚   Managers   â”‚          â”‚   Managers   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Config     â”‚          â”‚ â€¢ Events     â”‚
â”‚ â€¢ Logger     â”‚          â”‚ â€¢ State      â”‚
â”‚ â€¢ Environmentâ”‚          â”‚ â€¢ Plugins    â”‚
â”‚ â€¢ Lifecycle  â”‚          â”‚ â€¢ Cache      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â€¢ Performanceâ”‚
                          â”‚ â€¢ Security   â”‚
                          â”‚ â€¢ ...        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### 1. Engine Coreï¼ˆå¼•æ“æ ¸å¿ƒï¼‰

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰å­ç®¡ç†å™¨çš„ç”Ÿå‘½å‘¨æœŸ
- æä¾›ç»Ÿä¸€çš„æ’ä»¶ç³»ç»Ÿ
- é›†æˆVueåº”ç”¨
- åè°ƒå„æ¨¡å—é—´çš„é€šä¿¡

**å…³é”®ç‰¹æ€§**ï¼š
- **æ‡’åŠ è½½ç­–ç•¥**ï¼š10ä¸ªç®¡ç†å™¨æŒ‰éœ€åˆå§‹åŒ–
- **ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨ManagerRegistryç®¡ç†ä¾èµ–å…³ç³»
- **ç”Ÿå‘½å‘¨æœŸé’©å­**ï¼šbeforeInitã€afterInitã€beforeMountç­‰
- **é€‚é…å™¨æ¨¡å¼**ï¼šæ”¯æŒRouterã€Storeã€I18nã€Themeé€‚é…å™¨

**åˆå§‹åŒ–æ€§èƒ½**ï¼š
- ç«‹å³åˆå§‹åŒ–ï¼šçº¦5-7ms
- æ‡’åŠ è½½ç®¡ç†å™¨ï¼šé¦–æ¬¡è®¿é—®æ—¶åˆå§‹åŒ–ï¼ˆ1-2msï¼‰

### 2. State Managerï¼ˆçŠ¶æ€ç®¡ç†ï¼‰

**èŒè´£**ï¼š
- æä¾›å“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†
- æ”¯æŒåµŒå¥—è·¯å¾„è®¿é—®
- çŠ¶æ€ç›‘å¬å’Œå˜æ›´è¿½è¸ª
- å†å²è®°å½•å’Œæ’¤é”€åŠŸèƒ½

**æ ¸å¿ƒç®—æ³•**ï¼š
```typescript
// è·¯å¾„è®¿é—®ä¼˜åŒ–ï¼ˆ73%æå‡ï¼‰
1. LRUç¼“å­˜ï¼šç¼“å­˜æœ€è¿‘è®¿é—®çš„è·¯å¾„å€¼
2. è·¯å¾„ç¼–è¯‘ç¼“å­˜ï¼šé¢„è§£æsplitç»“æœ
3. å•å±‚è®¿é—®å¿«é€Ÿè·¯å¾„ï¼šè·³è¿‡è·¯å¾„è§£æ
```

**æ€§èƒ½æ•°æ®**ï¼š
- å•å±‚è®¿é—®ï¼š0.1Î¼s
- åµŒå¥—è®¿é—®ï¼ˆæœ‰ç¼“å­˜ï¼‰ï¼š0.3Î¼s
- åµŒå¥—è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰ï¼š0.5Î¼s

### 3. Event Managerï¼ˆäº‹ä»¶ç®¡ç†ï¼‰

**èŒè´£**ï¼š
- å‘å¸ƒè®¢é˜…æ¨¡å¼äº‹ä»¶ç³»ç»Ÿ
- æ”¯æŒäº‹ä»¶ä¼˜å…ˆçº§
- å‘½åç©ºé—´éš”ç¦»
- æ‰¹é‡æ“ä½œ

**æ ¸å¿ƒç®—æ³•**ï¼š
```typescript
// ä¼˜å…ˆçº§æ¡¶æœºåˆ¶ï¼ˆ80%æå‡ï¼‰
ä¼ ç»Ÿæ–¹å¼: sort() O(n log n) - 25Î¼s
ä¼˜å…ˆçº§æ¡¶: é¢„åˆ†ç»„ O(n) - 5Î¼s

// ä¸‰çº§å¿«é€Ÿè·¯å¾„
1. å•ç›‘å¬å™¨ï¼šç›´æ¥æ‰§è¡Œ
2. æ— ä¼˜å…ˆçº§ï¼šç›´æ¥éå†  
3. æœ‰ä¼˜å…ˆçº§ï¼šä½¿ç”¨æ¡¶
```

**å†…å­˜ä¼˜åŒ–**ï¼š
- å¯¹è±¡æ± ï¼šå‡å°‘70%å¯¹è±¡åˆ†é…
- WeakMapç¼“å­˜ï¼šé¿å…å†…å­˜æ³„æ¼
- è‡ªåŠ¨æ¸…ç†ï¼šå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

### 4. Cache Managerï¼ˆç¼“å­˜ç®¡ç†ï¼‰

**èŒè´£**ï¼š
- å¤šçº§ç¼“å­˜ç®¡ç†
- å¤šç§æ·˜æ±°ç­–ç•¥ï¼ˆLRUã€LFUã€FIFOã€TTLï¼‰
- æ™ºèƒ½åˆ†ç‰‡
- ç¼“å­˜é¢„çƒ­

**æ¶æ„**ï¼š
```typescript
// å¤šçº§ç¼“å­˜
L1: å†…å­˜ç¼“å­˜ï¼ˆæœ€å¿«ï¼Œ200æ¡ï¼‰
  â†“ miss
L2: LocalStorageï¼ˆæŒä¹…åŒ–ï¼‰
  â†“ miss
L3: SessionStorageï¼ˆä¼šè¯çº§ï¼‰
  â†“ miss
L4: IndexedDBï¼ˆå¤§å®¹é‡ï¼Œå¼‚æ­¥ï¼‰
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- ç±»å‹é¢„ä¼°è¡¨ï¼šO(1)å¯¹è±¡å¤§å°ä¼°ç®—
- æ™ºèƒ½åˆ†ç‰‡ï¼š16åˆ†ç‰‡ï¼ŒO(n/16)æŸ¥æ‰¾
- æ·±åº¦é™åˆ¶ï¼šæœ€å¤š3å±‚éå†

### 5. Plugin Managerï¼ˆæ’ä»¶ç®¡ç†ï¼‰

**èŒè´£**ï¼š
- æ’ä»¶æ³¨å†Œå’Œå¸è½½
- ä¾èµ–è§£æå’ŒéªŒè¯
- å¾ªç¯ä¾èµ–æ£€æµ‹
- æ‹“æ‰‘æ’åºåŠ è½½

**æ ¸å¿ƒç®—æ³•**ï¼š
```typescript
// Kahnæ‹“æ‰‘æ’åºï¼ˆ76%æå‡ï¼‰
æ—¶é—´å¤æ‚åº¦: O(n + e)
n: æ’ä»¶æ•°é‡
e: ä¾èµ–å…³ç³»æ•°é‡

ç®—æ³•æµç¨‹:
1. è®¡ç®—æ‰€æœ‰èŠ‚ç‚¹å…¥åº¦
2. å°†å…¥åº¦ä¸º0çš„èŠ‚ç‚¹å…¥é˜Ÿ
3. å¤„ç†é˜Ÿåˆ—èŠ‚ç‚¹ï¼Œå‡å°‘ä¾èµ–è€…å…¥åº¦
4. é‡å¤ç›´åˆ°é˜Ÿåˆ—ä¸ºç©º
5. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–
```

**ç¼“å­˜ä¼˜åŒ–**ï¼š
- ä¾èµ–æ ¡éªŒç¼“å­˜ï¼š60ç§’TTL
- ä¾èµ–å›¾ç¼“å­˜ï¼šå˜æ›´æ—¶å¤±æ•ˆ
- æ‹“æ‰‘æ’åºç¼“å­˜ï¼šå¢é‡æ›´æ–°

## ğŸ”„ æ•°æ®æµ

### äº‹ä»¶æµ

```
ç”¨æˆ·æ“ä½œ/å¤–éƒ¨äº‹ä»¶
  â†“
Middleware Pipeline
  â†“
Event Manager
  â†“
Event Listeners (æŒ‰ä¼˜å…ˆçº§)
  â†“
State Manager (æ›´æ–°çŠ¶æ€)
  â†“
Vue Reactivity (è§¦å‘UIæ›´æ–°)
```

### çŠ¶æ€æµ

```
Action/Mutation
  â†“
State Manager
  â”œâ”€ Validation
  â”œâ”€ Change History
  â””â”€ Cache Invalidation
  â†“
Watchers Notification
  â†“
Component Updates
```

### æ’ä»¶åŠ è½½æµç¨‹

```
Plugin Registration
  â†“
Dependency Check
  â†“
Topological Sort
  â†“
Create Plugin Context
  â†“
Execute install()
  â†“
Update Dependency Graph
```

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. æ‡’åŠ è½½æ¨¡å¼ï¼ˆLazy Loadingï¼‰

**åº”ç”¨**ï¼šæ‰€æœ‰ä¸šåŠ¡ç®¡ç†å™¨
```typescript
get events(): EventManager {
  if (!this._events) {
    this._events = createEventManager()
  }
  return this._events
}
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘å¯åŠ¨æ—¶é—´70%
- é™ä½å†…å­˜å ç”¨
- æŒ‰éœ€åŠ è½½æ¨¡å—

### 2. å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰

**åº”ç”¨**ï¼šæ‰€æœ‰ç®¡ç†å™¨
```typescript
// æ¯ä¸ªç®¡ç†å™¨åœ¨å¼•æ“ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
private _events?: EventManager // å•ä¾‹
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- é¿å…èµ„æºé‡å¤åˆ›å»º
- ç®€åŒ–ä¾èµ–ç®¡ç†

### 3. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰

**åº”ç”¨**ï¼šäº‹ä»¶ç³»ç»Ÿã€çŠ¶æ€ç›‘å¬
```typescript
// äº‹ä»¶ç³»ç»Ÿ
eventManager.on('event', handler)
eventManager.emit('event', data)

// çŠ¶æ€ç›‘å¬
stateManager.watch('key', callback)
```

**ä¼˜åŠ¿**ï¼š
- è§£è€¦æ¨¡å—é—´é€šä¿¡
- æ”¯æŒä¸€å¯¹å¤šé€šçŸ¥
- åŠ¨æ€è®¢é˜…/å–æ¶ˆ

### 4. ä¸­é—´ä»¶æ¨¡å¼ï¼ˆMiddlewareï¼‰

**åº”ç”¨**ï¼šè¯·æ±‚/å“åº”å¤„ç†
```typescript
middlewareManager.use({
  name: 'auth',
  handler: async (context, next) => {
    // å‰ç½®å¤„ç†
    await next()
    // åç½®å¤„ç†
  }
})
```

**ä¼˜åŠ¿**ï¼š
- æ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»
- å¯æ’æ‹”çš„åŠŸèƒ½æ¨¡å—
- é“¾å¼å¤„ç†æµç¨‹

### 5. ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰

**åº”ç”¨**ï¼šç¼“å­˜æ·˜æ±°ç­–ç•¥
```typescript
// å¯é…ç½®çš„æ·˜æ±°ç­–ç•¥
cacheManager.setStrategy('lru')
cacheManager.setStrategy('lfu')
cacheManager.setStrategy('fifo')
```

**ä¼˜åŠ¿**ï¼š
- ç®—æ³•å¯æ›¿æ¢
- è¿è¡Œæ—¶åˆ‡æ¢ç­–ç•¥
- æ˜“äºæ‰©å±•

### 6. å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰

**åº”ç”¨**ï¼šç®¡ç†å™¨åˆ›å»º
```typescript
// å·¥å‚å‡½æ•°
createEventManager()
createStateManager()
createCacheManager()
```

**ä¼˜åŠ¿**ï¼š
- å°è£…åˆ›å»ºé€»è¾‘
- ç»Ÿä¸€æ¥å£
- ä¾¿äºæµ‹è¯•

### 7. ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰

**åº”ç”¨**ï¼šæ–°å¢çš„DIContainer
```typescript
container.register('Logger', Logger, 'singleton')
container.register('UserService', UserService, 'transient', ['Logger'])
const service = container.resolve('UserService')
```

**ä¼˜åŠ¿**ï¼š
- è§£è€¦ç»„ä»¶ä¾èµ–
- ä¾¿äºæµ‹è¯•mock
- è‡ªåŠ¨ä¾èµ–è§£æ

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

#### æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰
```typescript
// ç«‹å³åˆå§‹åŒ–ï¼ˆå¿…éœ€ï¼‰
- config
- logger  
- environment
- lifecycle

// æ‡’åŠ è½½ï¼ˆæŒ‰éœ€ï¼‰
- events
- state
- plugins
- cache
- performance
- security
```

**æ•ˆæœ**ï¼š
- åˆå§‹åŒ–æ—¶é—´ï¼š25ms â†’ 7msï¼ˆ72%æå‡ï¼‰
- å†…å­˜å ç”¨ï¼šå‡å°‘35%

#### å»¶è¿Ÿæ‰§è¡Œï¼ˆDeferred Executionï¼‰
```typescript
// å¼‚æ­¥æ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­
Promise.resolve().then(() => {
  this.lifecycle.execute('afterInit', this)
})
```

**æ•ˆæœ**ï¼š
- é¿å…æ„é€ å‡½æ•°é˜»å¡
- æå‡å“åº”é€Ÿåº¦

### 2. è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–

#### è·¯å¾„è®¿é—®ä¼˜åŒ–
```typescript
// 1. å•å±‚è®¿é—®å¿«é€Ÿè·¯å¾„
if (!key.includes('.')) {
  return obj[key]
}

// 2. è·¯å¾„ç¼–è¯‘ç¼“å­˜
let segments = pathCache.get(key)
if (!segments) {
  segments = key.split('.')
  pathCache.set(key, segments)
}
```

**æ•ˆæœ**ï¼š
- æ€§èƒ½æå‡73%
- ç¼“å­˜å‘½ä¸­ç‡>80%

#### ä¼˜å…ˆçº§æ¡¶æœºåˆ¶
```typescript
// é¢„å…ˆæŒ‰ä¼˜å…ˆçº§åˆ†ç»„
priorityBuckets = {
  100: [listener1, listener2],
  0: [listener3],
  -100: [listener4]
}

// è§¦å‘æ—¶ç›´æ¥éå†ï¼Œæ— éœ€æ’åº
for (const priority of sortedPriorities) {
  const bucket = priorityBuckets[priority]
  bucket.forEach(listener => listener())
}
```

**æ•ˆæœ**ï¼š
- æ€§èƒ½æå‡80%
- O(n log n) â†’ O(n)

#### å¯¹è±¡æ± å¤ç”¨
```typescript
class EventObjectPool {
  get(): EventListener {
    return this.pool.pop() || createNew()
  }
  
  release(obj: EventListener): void {
    this.pool.push(obj)
  }
}
```

**æ•ˆæœ**ï¼š
- å‡å°‘70%å¯¹è±¡åˆ†é…
- é™ä½GCå‹åŠ›

### 3. å†…å­˜ä¼˜åŒ–

#### å¼•ç”¨è®¡æ•°
```typescript
// æ›¿ä»£WeakRefçš„ä¸ç¡®å®šæ€§
watcherRefCounts.set(callback, count + 1)
```

**æ•ˆæœ**ï¼š
- æ¶ˆé™¤å†…å­˜æ³„æ¼
- ç²¾ç¡®æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ

#### å›ºå®šå¤§å°ç¼“å†²åŒº
```typescript
// ç¯å½¢ç¼“å†²åŒº
if (buffer.length >= maxSize) {
  buffer.shift()  // ç§»é™¤æœ€æ—§çš„
}
buffer.push(newItem)
```

**æ•ˆæœ**ï¼š
- å›ºå®šå†…å­˜å ç”¨
- é¿å…æ— é™å¢é•¿

#### æ™ºèƒ½åˆ†ç‰‡
```typescript
// è¶…è¿‡100æ¡è‡ªåŠ¨å¯ç”¨16åˆ†ç‰‡
if (maxSize > 100) {
  shards = Array(16).fill(null).map(() => new Map())
}

// å“ˆå¸Œåˆ†é…
const shardIndex = hash(key) % 16
const shard = shards[shardIndex]
```

**æ•ˆæœ**ï¼š
- å‡å°‘å•ä¸ªMapå¤§å°
- æå‡æŸ¥æ‰¾æ€§èƒ½

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

```
æ³¨å†Œ â†’ ä¾èµ–æ£€æŸ¥ â†’ æ’åº â†’ å®‰è£… â†’ è¿è¡Œ â†’ å¸è½½
  â†“       â†“         â†“       â†“      â†“      â†“
[æ£€æŸ¥]  [Kahn]  [Context] [Hook] [Use] [Cleanup]
```

### ä¾èµ–è§£ææµç¨‹

```typescript
// 1. æ³¨å†Œæ’ä»¶
register(plugin)
  â†“
// 2. æ£€æŸ¥ä¾èµ–
checkDependencies()
  â†“
// 3. æ‹“æ‰‘æ’åº
topologicalSort()
  â†“
// 4. åˆ›å»ºä¸Šä¸‹æ–‡
createPluginContext()
  â†“
// 5. æ‰§è¡Œå®‰è£…
plugin.install(context)
```

### å¾ªç¯ä¾èµ–æ£€æµ‹

```typescript
A â†’ B â†’ C â†’ A  // å¾ªç¯ï¼

// Kahnç®—æ³•è‡ªåŠ¨æ£€æµ‹
if (sortedList.length !== totalPlugins) {
  throw new Error('æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–')
}
```

## ğŸ’¾ çŠ¶æ€ç®¡ç†

### çŠ¶æ€å±‚æ¬¡ç»“æ„

```
Global State (Reactive)
  â”œâ”€â”€ Namespaces
  â”‚   â”œâ”€â”€ user
  â”‚   â”‚   â”œâ”€â”€ profile
  â”‚   â”‚   â””â”€â”€ settings
  â”‚   â”œâ”€â”€ app
  â”‚   â”‚   â”œâ”€â”€ theme
  â”‚   â”‚   â””â”€â”€ locale
  â”‚   â””â”€â”€ cache
  â””â”€â”€ Watchers
      â”œâ”€â”€ user.profile â†’ [callback1, callback2]
      â””â”€â”€ app.theme â†’ [callback3]
```

### å˜æ›´æµç¨‹

```
set('key', value)
  â†“
è®°å½•å†å² (History)
  â†“
è®¾ç½®æ–°å€¼ (Reactive)
  â†“
å¤±æ•ˆç¼“å­˜ (Cache Invalidation)
  â†“
è§¦å‘ç›‘å¬å™¨ (Watchers)
  â†“
ç»„ä»¶æ›´æ–° (Vue Reactivity)
```

## ğŸ“¡ äº‹ä»¶ç³»ç»Ÿ

### äº‹ä»¶æµ

```
emit('event', data)
  â†“
æ›´æ–°ç»Ÿè®¡ (Stats)
  â†“
é€‰æ‹©è·¯å¾„
  â”œâ”€ å¿«é€Ÿè·¯å¾„1: å•ç›‘å¬å™¨
  â”œâ”€ å¿«é€Ÿè·¯å¾„2: æ— ä¼˜å…ˆçº§
  â””â”€ ä¼˜å…ˆçº§æ¡¶: æœ‰ä¼˜å…ˆçº§
  â†“
æ‰§è¡Œç›‘å¬å™¨ (Handlers)
  â†“
æ¸…ç†ä¸€æ¬¡æ€§ç›‘å¬å™¨ (Once)
```

### ä¼˜å…ˆçº§æœºåˆ¶

```
ä¼˜å…ˆçº§æ¡¶ç»“æ„:
{
  'event:name': {
    100: [handler1, handler2],  // é«˜ä¼˜å…ˆçº§ï¼ˆå…ˆæ‰§è¡Œï¼‰
    0: [handler3, handler4],     // é»˜è®¤ä¼˜å…ˆçº§
    -100: [handler5]             // ä½ä¼˜å…ˆçº§ï¼ˆåæ‰§è¡Œï¼‰
  }
}

æ‰§è¡Œé¡ºåº: 100 â†’ 0 â†’ -100
```

## ğŸ’¾ ç¼“å­˜ç³»ç»Ÿ

### å¤šçº§ç¼“å­˜æ¶æ„

```
æŸ¥è¯¢ç¼“å­˜('key')
  â†“
L1: Memory Cache
  â”œâ”€ å‘½ä¸­: è¿”å›ï¼ˆæœ€å¿« ~0.1msï¼‰
  â””â”€ æœªå‘½ä¸­: â†“
L2: LocalStorage
  â”œâ”€ å‘½ä¸­: å›å¡«L1ï¼Œè¿”å›ï¼ˆ~1msï¼‰
  â””â”€ æœªå‘½ä¸­: â†“
L3: SessionStorage
  â”œâ”€ å‘½ä¸­: å›å¡«L1+L2ï¼Œè¿”å›ï¼ˆ~2msï¼‰
  â””â”€ æœªå‘½ä¸­: â†“
L4: IndexedDB
  â”œâ”€ å‘½ä¸­: å›å¡«æ‰€æœ‰å±‚ï¼Œè¿”å›ï¼ˆ~5msï¼‰
  â””â”€ æœªå‘½ä¸­: è¿”å›undefined
```

### æ·˜æ±°ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | æ—¶é—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | å‘½ä¸­ç‡ |
|-----|-----------|---------|--------|
| LRU | O(1) | é€šç”¨åœºæ™¯ | é«˜ |
| LFU | O(log n) | çƒ­ç‚¹æ•°æ® | æœ€é«˜ |
| FIFO | O(1) | ç®€å•åœºæ™¯ | ä¸­ |
| TTL | O(1) | æ—¶æ•ˆæ•°æ® | ä¸­ä½ |

## ğŸ”’ å®‰å…¨æ¶æ„

### å®‰å…¨å±‚æ¬¡

```
è¾“å…¥
  â†“
è¾“å…¥éªŒè¯ (Validation)
  â†“
XSSè¿‡æ»¤ (Sanitization)
  â†“
CSRFæ£€æŸ¥ (Token Verification)
  â†“
æƒé™éªŒè¯ (Permission Check)
  â†“
ä¸šåŠ¡é€»è¾‘
  â†“
è¾“å‡ºè¿‡æ»¤ (Output Encoding)
  â†“
CSPç­–ç•¥ (Content Security Policy)
  â†“
è¾“å‡º
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### ç›‘æ§æŒ‡æ ‡

```typescript
æ€§èƒ½æŒ‡æ ‡
  â”œâ”€â”€ åº”ç”¨åŠ è½½
  â”‚   â”œâ”€â”€ é¦–å±æ—¶é—´ (FCP)
  â”‚   â”œâ”€â”€ å¯äº¤äº’æ—¶é—´ (TTI)
  â”‚   â””â”€â”€ å®Œå…¨åŠ è½½ (Load)
  â”œâ”€â”€ ç»„ä»¶æ¸²æŸ“
  â”‚   â”œâ”€â”€ æŒ‚è½½æ—¶é—´
  â”‚   â”œâ”€â”€ æ›´æ–°æ—¶é—´
  â”‚   â””â”€â”€ æ¸²æŸ“FPS
  â”œâ”€â”€ ç½‘ç»œè¯·æ±‚
  â”‚   â”œâ”€â”€ è¯·æ±‚å»¶è¿Ÿ
  â”‚   â”œâ”€â”€ å“åº”æ—¶é—´
  â”‚   â””â”€â”€ å¸¦å®½ä½¿ç”¨
  â””â”€â”€ å†…å­˜ä½¿ç”¨
      â”œâ”€â”€ å †å†…å­˜
      â”œâ”€â”€ å®æ—¶å†…å­˜
      â””â”€â”€ GCé¢‘ç‡
```

### æ€§èƒ½é¢„ç®—

```typescript
budgets = {
  initialization: 100ms,  // åˆå§‹åŒ–
  rendering: 16ms,        // æ¸²æŸ“ï¼ˆ60fpsï¼‰
  apiCall: 500ms,         // APIè°ƒç”¨
  bundleSize: 200KB       // åŒ…å¤§å°
}

// è¶…å‡ºé¢„ç®—è‡ªåŠ¨å‘Šè­¦
if (actual > budget) {
  performanceManager.emit('budget:exceeded', {
    metric: 'initialization',
    budget: 100,
    actual: 150
  })
}
```

## ğŸ› ï¸ å¼€å‘è€…å·¥å…·

### DevToolsé›†æˆ

```typescript
Vue DevTools
  â”œâ”€â”€ è‡ªå®šä¹‰æ£€æŸ¥å™¨
  â”‚   â”œâ”€â”€ å¼•æ“é…ç½®
  â”‚   â”œâ”€â”€ çŠ¶æ€æ ‘
  â”‚   â”œâ”€â”€ äº‹ä»¶åˆ—è¡¨
  â”‚   â””â”€â”€ æ’ä»¶ä¿¡æ¯
  â”œâ”€â”€ æ—¶é—´çº¿
  â”‚   â”œâ”€â”€ æ€§èƒ½äº‹ä»¶
  â”‚   â”œâ”€â”€ çŠ¶æ€å˜åŒ–
  â”‚   â”œâ”€â”€ äº‹ä»¶è§¦å‘
  â”‚   â””â”€â”€ é”™è¯¯è®°å½•
  â””â”€â”€ æ€§èƒ½åˆ†æ
      â”œâ”€â”€ ç«ç„°å›¾
      â”œâ”€â”€ å†…å­˜æ—¶é—´çº¿
      â””â”€â”€ äº‹ä»¶æµå›¾
```

### æ–°å¢å¯è§†åŒ–å·¥å…·

1. **æ€§èƒ½ç«ç„°å›¾**ï¼š
   - è°ƒç”¨æ ˆå¯è§†åŒ–
   - çƒ­ç‚¹å‡½æ•°è¯†åˆ«
   - æ€§èƒ½ç“¶é¢ˆå®šä½

2. **å†…å­˜æ—¶é—´çº¿**ï¼š
   - å®æ—¶å†…å­˜è¿½è¸ª
   - æ³„æ¼æ£€æµ‹
   - è¶‹åŠ¿åˆ†æ

3. **äº‹ä»¶æµå¯è§†åŒ–**ï¼š
   - äº‹ä»¶ä¼ æ’­è·¯å¾„
   - Mermaidå›¾è¡¨ç”Ÿæˆ
   - ç»Ÿè®¡åˆ†æ

## ğŸ”— æ¨¡å—ä¾èµ–å…³ç³»

### æ ¸å¿ƒä¾èµ–å›¾

```
                config (æ— ä¾èµ–)
                  â†“
                logger
                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼
  environment          lifecycle
        â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼
     events            state
        â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
              plugins
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼
   middleware        directives
```

### å¯é€‰ä¾èµ–

```
Performance Manager
  â”œâ”€ engine (å¯é€‰)
  â””â”€ config (å¯é€‰)

Security Manager  
  â”œâ”€ engine (å¯é€‰)
  â””â”€ config (å¯é€‰)

Cache Manager
  â””â”€ config (å¯é€‰)
```

## ğŸ“¦ æ¨¡å—è¾¹ç•Œ

### æ ¸å¿ƒæ¨¡å—ï¼ˆCoreï¼‰
- engine.ts
- manager-registry.ts
- module-loader.ts
- di-container.ts

### ä¸šåŠ¡æ¨¡å—ï¼ˆModulesï¼‰
- state/
- events/
- cache/
- plugins/

### å·¥å…·æ¨¡å—ï¼ˆUtilsï¼‰
- data-processing.ts
- async-helpers.ts
- security-helpers.ts

### é›†æˆæ¨¡å—ï¼ˆIntegrationsï¼‰
- vue/
- devtools/

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨æ‡’åŠ è½½

```typescript
// âœ… æ¨è
const engine = createEngine()
if (needsEvents) {
  engine.events.on('event', handler)
}

// âŒ é¿å…
const engine = createEngine()
engine.events // è¿‡æ—©è®¿é—®
engine.state  // è¿‡æ—©è®¿é—®
engine.cache  // è¿‡æ—©è®¿é—®
```

### 2. åˆ©ç”¨æ‰¹é‡æ“ä½œ

```typescript
// âœ… æ¨èï¼šæ‰¹é‡æ“ä½œ
engine.state.batchSet({
  'user.name': 'Alice',
  'user.age': 30
})

// âŒ é¿å…ï¼šé¢‘ç¹å•ç‹¬æ“ä½œ
engine.state.set('user.name', 'Alice')
engine.state.set('user.age', 30)
```

### 3. ä½¿ç”¨å‘½åç©ºé—´

```typescript
// âœ… æ¨èï¼šä½¿ç”¨å‘½åç©ºé—´éš”ç¦»
const userState = engine.state.namespace('user')
const userEvents = engine.events.namespace('user')

// æ¸…ç†æ•´ä¸ªå‘½åç©ºé—´
userState.clear()
userEvents.clear()
```

### 4. åŠæ—¶æ¸…ç†èµ„æº

```typescript
// âœ… æ¨èï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†
onBeforeUnmount(async () => {
  unwatch()           // å–æ¶ˆç›‘å¬
  offEvent()          // ç§»é™¤äº‹ä»¶
  await engine.destroy() // é”€æ¯å¼•æ“
})
```

## ğŸ“ˆ æ‰©å±•æ€§

### æ’ä»¶æ‰©å±•ç‚¹

```typescript
plugin.install(context)
  â”œâ”€ context.engine   // è®¿é—®å¼•æ“
  â”œâ”€ context.logger   // ä½¿ç”¨æ—¥å¿—
  â”œâ”€ context.config   // è¯»å–é…ç½®
  â””â”€ context.events   // ç›‘å¬äº‹ä»¶
```

### ä¸­é—´ä»¶æ‰©å±•ç‚¹

```typescript
middleware.handler(context, next)
  â”œâ”€ context.request  // è¯·æ±‚å¯¹è±¡
  â”œâ”€ context.response // å“åº”å¯¹è±¡
  â””â”€ next()           // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
```

### ç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹

```typescript
lifecycle.on('beforeInit', handler)
lifecycle.on('afterInit', handler)
lifecycle.on('beforeMount', handler)
lifecycle.on('afterMount', handler)
lifecycle.on('beforeUnmount', handler)
lifecycle.on('afterUnmount', handler)
lifecycle.on('beforeDestroy', handler)
lifecycle.on('afterDestroy', handler)
```

## ğŸ”§ é…ç½®ç³»ç»Ÿ

### é…ç½®å±‚æ¬¡

```
é»˜è®¤é…ç½® (Default)
  â†“
ç”¨æˆ·é…ç½® (User Config)
  â†“
è¿è¡Œæ—¶é…ç½® (Runtime)
  â†“
ç¯å¢ƒå˜é‡ (Environment)
```

### é…ç½®éªŒè¯

```typescript
configManager.setSchema({
  debug: { type: 'boolean', default: false },
  logger: {
    level: { type: 'string', enum: ['debug', 'info', 'warn', 'error'] }
  },
  cache: {
    maxSize: { type: 'number', min: 1, max: 10000 }
  }
})
```

## ğŸ“Š ç›‘æ§å’Œè¯Šæ–­

### æ€§èƒ½ç›‘æ§

```typescript
// æ ‡è®°å’Œæµ‹é‡
performance.mark('operation-start')
await operation()
performance.mark('operation-end')
const duration = performance.measure('operation', 'operation-start', 'operation-end')
```

### å†…å­˜ç›‘æ§

```typescript
// å®æ—¶ç›‘æ§
const timeline = createMemoryTimeline()
timeline.start(1000) // æ¯ç§’é‡‡æ ·

// æ³„æ¼æ£€æµ‹
const leak = timeline.detectLeaks()
if (leak.suspected) {
  console.warn('å¯ç–‘å†…å­˜æ³„æ¼:', leak.reason)
}
```

### äº‹ä»¶ç›‘æ§

```typescript
// äº‹ä»¶æµå¯è§†åŒ–
const visualizer = createEventFlowVisualizer()
visualizer.start()

// ç”Ÿæˆå›¾è¡¨
const mermaid = visualizer.generateMermaidDiagram()
```

## ğŸ“ æŠ€æœ¯é€‰å‹

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬è¦æ±‚ |
|-----|------|---------|
| Vue 3 | å“åº”å¼ç³»ç»Ÿ | ^3.5.18 |
| TypeScript | ç±»å‹ç³»ç»Ÿ | ^5.7.3 |
| Vite | æ„å»ºå·¥å…· | ^5.0.12 |
| Vitest | æµ‹è¯•æ¡†æ¶ | ^3.2.4 |

### ç®—æ³•é€‰æ‹©

| åœºæ™¯ | ç®—æ³• | å¤æ‚åº¦ | åŸå›  |
|-----|------|--------|------|
| æ’ä»¶æ’åº | Kahnæ‹“æ‰‘æ’åº | O(n+e) | ä¾èµ–è§£æ |
| ç¼“å­˜æ·˜æ±° | LRU | O(1) | é«˜æ€§èƒ½ |
| äº‹ä»¶æ’åº | ä¼˜å…ˆçº§æ¡¶ | O(n) | é¿å…æ’åº |
| æ·±æ‹·è´ | è¿­ä»£éå† | O(n) | é¿å…æ ˆæº¢å‡º |

## ğŸš€ æœªæ¥è§„åˆ’

### çŸ­æœŸï¼ˆv0.4.0ï¼‰
- [ ] SSR/SSGæ”¯æŒ
- [ ] PWAåŠŸèƒ½å¢å¼º
- [ ] å›½é™…åŒ–å¢å¼º
- [ ] å¾®å‰ç«¯æ”¯æŒå®Œå–„

### ä¸­æœŸï¼ˆv0.5.0ï¼‰
- [ ] Workerçº¿ç¨‹ä¼˜åŒ–
- [ ] WebAssemblyé›†æˆ
- [ ] æµå¼æ¸²æŸ“
- [ ] è¾¹ç¼˜è®¡ç®—æ”¯æŒ

### é•¿æœŸï¼ˆv1.0.0ï¼‰
- [ ] æ’ä»¶å¸‚åœº
- [ ] å¯è§†åŒ–é…ç½®ç•Œé¢
- [ ] è‡ªåŠ¨æ€§èƒ½ä¼˜åŒ–
- [ ] AIè¾…åŠ©å¼€å‘

---

**æ–‡æ¡£ç‰ˆæœ¬**: v0.3.1  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤äººå‘˜**: LDesign Team
