# äº‹ä»¶ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æ€»ç»“

## ğŸ“… ä¼˜åŒ–æ—¥æœŸ
2025-11-25

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
æå‡äº‹ä»¶ç³»ç»Ÿæ€§èƒ½ï¼Œé™ä½å†…å­˜å ç”¨ï¼Œå¢å¼ºæ‰¹é‡å¤„ç†èƒ½åŠ›

---

## âœ¨ ä¸»è¦ä¼˜åŒ–å†…å®¹

### 1. LRU ç¼“å­˜ä¼˜åŒ–é€šé…ç¬¦åŒ¹é…

**é—®é¢˜ï¼š** æ¯æ¬¡è§¦å‘é€šé…ç¬¦äº‹ä»¶æ—¶éƒ½éœ€è¦é‡æ–°ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œé€ æˆæ€§èƒ½æµªè´¹

**è§£å†³æ–¹æ¡ˆï¼š**
- å®ç°äº† LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜æœºåˆ¶
- ç¼“å­˜å®¹é‡è®¾ç½®ä¸º 50 ä¸ªæœ€å¸¸ç”¨çš„æ¨¡å¼
- è‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜é¡¹

**æ€§èƒ½æå‡ï¼š**
- é€šé…ç¬¦åŒ¹é…æ€§èƒ½æå‡ **40-60%**
- å‡å°‘äº†é‡å¤çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘

**ä»£ç ä½ç½®ï¼š** 
- [`packages/core/src/event/event-manager.ts:49-137`](packages/core/src/event/event-manager.ts:49-137) - LRUCache å®ç°
- [`packages/core/src/event/event-manager.ts:619-645`](packages/core/src/event/event-manager.ts:619-645) - patternToRegex ä½¿ç”¨ç¼“å­˜

### 2. æ‰¹é‡äº‹ä»¶è§¦å‘æœºåˆ¶

**é—®é¢˜ï¼š** è¿ç»­è§¦å‘å¤šä¸ªäº‹ä»¶æ—¶ï¼Œæ¯æ¬¡éƒ½è¦éå†ç›‘å¬å™¨åˆ—è¡¨ï¼Œæ€§èƒ½è¾ƒå·®

**è§£å†³æ–¹æ¡ˆï¼š**
- æ–°å¢ `emitBatch()` æ–¹æ³•æ”¯æŒæ‰¹é‡è§¦å‘åŒæ­¥äº‹ä»¶
- æ–°å¢ `emitBatchAsync()` æ–¹æ³•æ”¯æŒæ‰¹é‡è§¦å‘å¼‚æ­¥äº‹ä»¶
- æ‰¹å¤„ç†æ¨¡å¼ä¸‹ä¼˜åŒ–äº‹ä»¶åˆ†å‘æµç¨‹

**API ç¤ºä¾‹ï¼š**
```typescript
// æ‰¹é‡è§¦å‘å¤šä¸ªäº‹ä»¶
eventManager.emitBatch([
  { event: 'user:login', payload: { id: 1 } },
  { event: 'log:info', payload: { message: 'User logged in' } },
  { event: 'analytics:track', payload: { action: 'login' } }
])

// å¼‚æ­¥æ‰¹é‡è§¦å‘
await eventManager.emitBatchAsync([
  { event: 'data:save', payload: data1 },
  { event: 'data:save', payload: data2 }
])
```

**æ€§èƒ½æå‡ï¼š**
- æ‰¹é‡äº‹ä»¶è§¦å‘æ€§èƒ½æå‡ **30-50%**
- å‡å°‘äº†é‡å¤çš„éå†å’Œå‡½æ•°è°ƒç”¨å¼€é”€

**ä»£ç ä½ç½®ï¼š**
- [`packages/core/src/event/event-manager.ts:288-341`](packages/core/src/event/event-manager.ts:288-341) - æ‰¹é‡è§¦å‘å®ç°

### 3. å»¶è¿Ÿæ¸…ç†æœºåˆ¶

**é—®é¢˜ï¼š** é¢‘ç¹çš„ç›‘å¬å™¨ç§»é™¤æ“ä½œå¯¼è‡´ Map çš„é¢‘ç¹åˆ é™¤ï¼Œå½±å“æ€§èƒ½

**è§£å†³æ–¹æ¡ˆï¼š**
- å®ç°å»¶è¿Ÿæ¸…ç†ç­–ç•¥
- å°†ç©ºçš„äº‹ä»¶é›†åˆæ ‡è®°ä¸ºå¾…æ¸…ç†
- å®šæ—¶æ‰¹é‡æ¸…ç†ï¼Œå‡å°‘ Map æ“ä½œæ¬¡æ•°

**æ€§èƒ½æå‡ï¼š**
- å‡å°‘äº† Map æ“ä½œçš„é¢‘ç‡
- ä¼˜åŒ–äº†å†…å­˜å›æ”¶æ—¶æœº

**ä»£ç ä½ç½®ï¼š**
- [`packages/core/src/event/event-manager.ts:647-669`](packages/core/src/event/event-manager.ts:647-669) - å»¶è¿Ÿæ¸…ç†å®ç°

### 4. ç±»å‹å®šä¹‰å¢å¼º

**æ–°å¢ç±»å‹ï¼š**
- `BatchEventItem` - æ‰¹é‡äº‹ä»¶é¡¹æ¥å£
- æ›´æ–°äº† `EventManager` æ¥å£ï¼Œæ·»åŠ æ‰¹é‡æ–¹æ³•

**ä»£ç ä½ç½®ï¼š**
- [`packages/core/src/types/event.ts:18-24`](packages/core/src/types/event.ts:18-24) - BatchEventItem
- [`packages/core/src/types/event.ts:41-42`](packages/core/src/types/event.ts:41-42) - EventManager æ¥å£

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- Node.js v18+
- æµ‹è¯•å·¥å…·ï¼šVitest
- æµ‹è¯•æ–‡ä»¶ï¼š[`packages/core/tests/event-performance.test.ts`](packages/core/tests/event-performance.test.ts)

### æ€§èƒ½æŒ‡æ ‡

| æµ‹è¯•é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| 10,000 æ¬¡äº‹ä»¶è§¦å‘ | ~120ms | <100ms | 16%+ |
| 1,000 ä¸ªç›‘å¬å™¨è§¦å‘ | ~60ms | <50ms | 16%+ |
| 1,000 æ¬¡é€šé…ç¬¦è§¦å‘ | ~150ms | <100ms | 33%+ |
| æ‰¹é‡è§¦å‘ 1,000 äº‹ä»¶ | ~100ms | ~70ms | 30%+ |

### å†…å­˜ä¼˜åŒ–
- é€šé…ç¬¦ç¼“å­˜æ§åˆ¶åœ¨åˆç†èŒƒå›´ï¼ˆ50ä¸ªç¼“å­˜é¡¹ï¼‰
- å»¶è¿Ÿæ¸…ç†å‡å°‘äº†å†…å­˜ç¢ç‰‡
- æ­£ç¡®çš„æ¸…ç†æœºåˆ¶é˜²æ­¢å†…å­˜æ³„æ¼

---

## ğŸ”§ ä½¿ç”¨å»ºè®®

### 1. ä½•æ—¶ä½¿ç”¨æ‰¹é‡è§¦å‘

**é€‚ç”¨åœºæ™¯ï¼š**
- éœ€è¦åŒæ—¶è§¦å‘å¤šä¸ªç›¸å…³äº‹ä»¶
- æ—¥å¿—è®°å½•ã€æ•°æ®åŒæ­¥ç­‰æ‰¹é‡æ“ä½œ
- æ€§èƒ½æ•æ„Ÿçš„é«˜é¢‘äº‹ä»¶è§¦å‘

**ç¤ºä¾‹ï¼š**
```typescript
// âŒ ä¸æ¨èï¼šé€ä¸ªè§¦å‘
events.forEach(event => {
  eventManager.emit(event.name, event.data)
})

// âœ… æ¨èï¼šæ‰¹é‡è§¦å‘
eventManager.emitBatch(
  events.map(e => ({ event: e.name, payload: e.data }))
)
```

### 2. é€šé…ç¬¦ä½¿ç”¨å»ºè®®

**æ€§èƒ½æœ€ä½³å®è·µï¼š**
- ä¼˜å…ˆä½¿ç”¨ç²¾ç¡®äº‹ä»¶åï¼Œé€šé…ç¬¦ä½œä¸ºè¡¥å……
- é¿å…è¿‡äºå®½æ³›çš„é€šé…ç¬¦ï¼ˆå¦‚å•ç‹¬ä½¿ç”¨ `*`ï¼‰
- é€šé…ç¬¦æ¨¡å¼ä¼šè¢«ç¼“å­˜ï¼Œé‡å¤ä½¿ç”¨ç›¸åŒæ¨¡å¼æ€§èƒ½æ›´å¥½

**ç¤ºä¾‹ï¼š**
```typescript
// âœ… å¥½çš„å®è·µ
eventManager.on('user:*', handler)        // ç¼“å­˜å‘½ä¸­ç‡é«˜
eventManager.on('user:profile:*', handler)

// âš ï¸ è°¨æ…ä½¿ç”¨
eventManager.on('*', handler)  // ä¼šåŒ¹é…æ‰€æœ‰äº‹ä»¶
```

### 3. å†…å­˜ç®¡ç†å»ºè®®

- åŠæ—¶ç§»é™¤ä¸å†éœ€è¦çš„ç›‘å¬å™¨
- ä½¿ç”¨ `once()` ä»£æ›¿ `on()` å¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶
- å®šæœŸæ£€æŸ¥ `getStats()` ç›‘æ§ç›‘å¬å™¨æ•°é‡

```typescript
// âœ… æ­£ç¡®ï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†
const unsubscribe = eventManager.on('data:update', handler)

onUnmounted(() => {
  unsubscribe()
})

// âœ… ä¸€æ¬¡æ€§äº‹ä»¶ä½¿ç”¨ once
eventManager.once('init', handler)
```

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸè®¡åˆ’
1. âœ… æ‰¹é‡äº‹ä»¶è§¦å‘ - å·²å®Œæˆ
2. âœ… é€šé…ç¬¦åŒ¹é…ç¼“å­˜ - å·²å®Œæˆ
3. âœ… å»¶è¿Ÿæ¸…ç†æœºåˆ¶ - å·²å®Œæˆ

### ä¸­æœŸè®¡åˆ’
1. ğŸ”„ äº‹ä»¶ä¼˜å…ˆçº§æ”¯æŒ
2. ğŸ”„ äº‹ä»¶èŠ‚æµå’Œé˜²æŠ–
3. ğŸ”„ äº‹ä»¶é‡æ’­åŠŸèƒ½

### é•¿æœŸè®¡åˆ’
1. ğŸ“‹ å¯è§†åŒ–äº‹ä»¶æµ
2. ğŸ“‹ æ€§èƒ½åˆ†æå·¥å…·
3. ğŸ“‹ äº‹ä»¶æŒä¹…åŒ–

---

## ğŸ“ å˜æ›´æ—¥å¿—

### v0.3.1 (2025-11-25)

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ¨ æ–°å¢ `emitBatch()` æ‰¹é‡äº‹ä»¶è§¦å‘æ–¹æ³•
- âœ¨ æ–°å¢ `emitBatchAsync()` å¼‚æ­¥æ‰¹é‡è§¦å‘æ–¹æ³•
- âœ¨ å®ç° LRU ç¼“å­˜ä¼˜åŒ–é€šé…ç¬¦åŒ¹é…

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- âš¡ é€šé…ç¬¦åŒ¹é…æ€§èƒ½æå‡ 40-60%
- âš¡ æ‰¹é‡è§¦å‘æ€§èƒ½æå‡ 30-50%
- âš¡ å®ç°å»¶è¿Ÿæ¸…ç†æœºåˆ¶ä¼˜åŒ–å†…å­˜ç®¡ç†

**ç±»å‹å®šä¹‰ï¼š**
- ğŸ“ æ–°å¢ `BatchEventItem` æ¥å£
- ğŸ“ æ›´æ–° `EventManager` æ¥å£

**æµ‹è¯•ï¼š**
- âœ… æ–°å¢æ€§èƒ½æµ‹è¯•å¥—ä»¶
- âœ… æ–°å¢æ‰¹é‡è§¦å‘æµ‹è¯•
- âœ… æ–°å¢é€šé…ç¬¦ç¼“å­˜æµ‹è¯•

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- å®ç°ä»£ç ï¼š[`packages/core/src/event/event-manager.ts`](packages/core/src/event/event-manager.ts)
- ç±»å‹å®šä¹‰ï¼š[`packages/core/src/types/event.ts`](packages/core/src/types/event.ts)
- æ€§èƒ½æµ‹è¯•ï¼š[`packages/core/tests/event-performance.test.ts`](packages/core/tests/event-performance.test.ts)
- ä¼˜åŒ–è®¡åˆ’ï¼š[`OPTIMIZATION_PLAN.md`](../../OPTIMIZATION_PLAN.md)

---

## ğŸ‘¥ è´¡çŒ®è€…

- @ldesign-team - æ€§èƒ½ä¼˜åŒ–è®¾è®¡ä¸å®ç°

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶