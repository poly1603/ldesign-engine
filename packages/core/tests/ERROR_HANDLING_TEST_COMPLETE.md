# âœ… é”™è¯¯å¤„ç†æµ‹è¯•å¥—ä»¶å®ŒæˆæŠ¥å‘Š

## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ

- **æµ‹è¯•æ–‡ä»¶**: `error-handling.test.ts`
- **æµ‹è¯•æ•°é‡**: 29ä¸ª
- **æµ‹è¯•é€šè¿‡**: 29ä¸ª âœ…
- **æµ‹è¯•å¤±è´¥**: 0ä¸ª
- **é€šè¿‡ç‡**: 100%
- **ä»£ç è¡Œæ•°**: 378è¡Œ
- **æ‰§è¡Œæ—¶é—´**: 191ms

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. æ’ä»¶é”™è¯¯å¤„ç† (6ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥æ•è·æ’ä»¶å®‰è£…æ—¶çš„é”™è¯¯**
- æµ‹è¯•æ’ä»¶ `install()` æ–¹æ³•æŠ›å‡ºé”™è¯¯æ—¶çš„å¤„ç†
- éªŒè¯é”™è¯¯è¢«æ­£ç¡®æ•è·å¹¶è®°å½•

âœ… **åº”è¯¥æ•è·å¼‚æ­¥æ’ä»¶å®‰è£…é”™è¯¯**
- æµ‹è¯•å¼‚æ­¥æ’ä»¶å®‰è£…å¤±è´¥çš„å¤„ç†
- éªŒè¯å¼‚æ­¥é”™è¯¯ä¼ æ’­æœºåˆ¶

âœ… **åº”è¯¥å¤„ç†æ’ä»¶å¸è½½é”™è¯¯**
- æµ‹è¯•æ’ä»¶ `uninstall()` æ–¹æ³•æŠ›å‡ºé”™è¯¯
- éªŒè¯å¸è½½é”™è¯¯ä¸å½±å“å¼•æ“çŠ¶æ€

âœ… **åº”è¯¥å¤„ç†é‡å¤å®‰è£…æ’ä»¶**
- æµ‹è¯•é‡å¤å®‰è£…åŒä¸€æ’ä»¶çš„è¡Œä¸º
- éªŒè¯å¼•æ“é‡‡ç”¨**é™é»˜è·³è¿‡**ç­–ç•¥ï¼ˆä¸æŠ›å‡ºé”™è¯¯ï¼‰

âœ… **åº”è¯¥å¤„ç†ç¼ºå¤±ä¾èµ–çš„æ’ä»¶**
- æµ‹è¯•å®‰è£…ä¾èµ–ç¼ºå¤±çš„æ’ä»¶
- éªŒè¯ä¾èµ–æ£€æŸ¥æœºåˆ¶æ­£å¸¸å·¥ä½œ

âœ… **åº”è¯¥å¤„ç†å¾ªç¯ä¾èµ–**
- æµ‹è¯•æ’ä»¶Aä¾èµ–Bï¼ŒBä¾èµ–Açš„æƒ…å†µ
- éªŒè¯å¾ªç¯ä¾èµ–è¢«æ­£ç¡®æ£€æµ‹

### 2. äº‹ä»¶é”™è¯¯å¤„ç† (5ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥æ•è·äº‹ä»¶ç›‘å¬å™¨ä¸­çš„é”™è¯¯**
- æµ‹è¯•åŒæ­¥ç›‘å¬å™¨æŠ›å‡ºé”™è¯¯æ—¶çš„å¤„ç†
- éªŒè¯é”™è¯¯è¢«æ•è·ï¼Œä¸å½±å“å…¶ä»–ç›‘å¬å™¨

âœ… **åº”è¯¥å¤„ç†å¼‚æ­¥äº‹ä»¶ç›‘å¬å™¨é”™è¯¯**
- æµ‹è¯•å¼‚æ­¥ç›‘å¬å™¨ä¸­çš„é”™è¯¯å¤„ç†
- ä½¿ç”¨ try-catch é˜²æ­¢æœªå¤„ç†çš„ Promise rejection

âœ… **åº”è¯¥å¤„ç†ç©ºäº‹ä»¶å**
- æµ‹è¯•ç©ºå­—ç¬¦ä¸²ä½œä¸ºäº‹ä»¶åçš„è¡Œä¸º
- éªŒè¯å¼•æ“å…è®¸ç©ºäº‹ä»¶åï¼ˆå®½å®¹ç­–ç•¥ï¼‰

âœ… **åº”è¯¥å¤„ç†ä¸å­˜åœ¨çš„äº‹ä»¶**
- æµ‹è¯•è§¦å‘æœªæ³¨å†Œçš„äº‹ä»¶
- éªŒè¯ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼ˆé™é»˜å¤±è´¥ï¼‰

âœ… **åº”è¯¥å¤„ç†æ— æ•ˆçš„ç›‘å¬å™¨**
- æµ‹è¯•éå‡½æ•°ç±»å‹çš„ç›‘å¬å™¨
- éªŒè¯è¿è¡Œæ—¶é”™è¯¯è¢«æ­£ç¡®æ•è·

### 3. çŠ¶æ€é”™è¯¯å¤„ç† (4ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥å¤„ç†æ— æ•ˆçš„çŠ¶æ€é”®**
- æµ‹è¯•ç©ºå­—ç¬¦ä¸²ã€nullã€undefined ä½œä¸ºçŠ¶æ€é”®
- éªŒè¯ Map ä¿ç•™åŸå§‹é”®ç±»å‹

âœ… **åº”è¯¥å¤„ç†å¾ªç¯å¼•ç”¨å¯¹è±¡**
- æµ‹è¯•åŒ…å«å¾ªç¯å¼•ç”¨çš„çŠ¶æ€å¯¹è±¡
- éªŒè¯å¼•æ“èƒ½å¤Ÿå­˜å‚¨å’Œæ£€ç´¢å¾ªç¯å¼•ç”¨å¯¹è±¡

âœ… **åº”è¯¥å¤„ç†å¤§å‹çŠ¶æ€å¯¹è±¡**
- æµ‹è¯•åŒ…å«1000ä¸ªå±æ€§çš„å¤§å¯¹è±¡
- éªŒè¯æ€§èƒ½ä¸å—å½±å“

âœ… **åº”è¯¥å¤„ç†çŠ¶æ€ç›‘å¬å™¨é”™è¯¯**
- æµ‹è¯•çŠ¶æ€å˜åŒ–ç›‘å¬å™¨ä¸­çš„é”™è¯¯
- éªŒè¯é”™è¯¯è¢«æ•è·ï¼Œä¸å½±å“çŠ¶æ€æ›´æ–°

### 4. ä¸­é—´ä»¶é”™è¯¯å¤„ç† (3ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥æ•è·ä¸­é—´ä»¶æ‰§è¡Œé”™è¯¯**
- æµ‹è¯•ä¸­é—´ä»¶æ‰§è¡Œæ—¶æŠ›å‡ºé”™è¯¯
- éªŒè¯é”™è¯¯è¢«æ­£ç¡®ä¼ æ’­

âœ… **åº”è¯¥å¤„ç†ä¸­é—´ä»¶æœªè°ƒç”¨ next**
- æµ‹è¯•ä¸­é—´ä»¶æœªè°ƒç”¨ `next()` çš„æƒ…å†µ
- éªŒè¯ä¸­é—´ä»¶é“¾æ­£å¸¸ä¸­æ–­

âœ… **åº”è¯¥å¤„ç†å¤šæ¬¡è°ƒç”¨ next**
- æµ‹è¯•ä¸­é—´ä»¶å¤šæ¬¡è°ƒç”¨ `next()`
- éªŒè¯é‡å¤è°ƒç”¨è¢«æ­£ç¡®å¤„ç†

### 5. ç”Ÿå‘½å‘¨æœŸé”™è¯¯å¤„ç† (3ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥æ•è·ç”Ÿå‘½å‘¨æœŸé’©å­é”™è¯¯**
- æµ‹è¯•ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„åŒæ­¥é”™è¯¯
- éªŒè¯é”™è¯¯è¢«æ•è·ï¼Œæ˜¾ç¤ºé”™è¯¯è®¡æ•°

âœ… **åº”è¯¥å¤„ç†å¼‚æ­¥é’©å­é”™è¯¯**
- æµ‹è¯•å¼‚æ­¥ç”Ÿå‘½å‘¨æœŸé’©å­çš„é”™è¯¯å¤„ç†
- éªŒè¯å¼‚æ­¥é”™è¯¯ä¸é˜»æ­¢å…¶ä»–é’©å­æ‰§è¡Œ

âœ… **åº”è¯¥å¤„ç†ä¸å­˜åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­**
- æµ‹è¯•è§¦å‘æœªæ³¨å†Œçš„é’©å­
- éªŒè¯ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼ˆé™é»˜å¤±è´¥ï¼‰

### 6. é…ç½®é”™è¯¯å¤„ç† (3ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥å¤„ç†å¼•æ“é…ç½®è®¿é—®**
- æµ‹è¯•è®¿é—®ä¸å­˜åœ¨çš„é…ç½®é¡¹
- éªŒè¯è¿”å› undefinedï¼ˆè€ŒéæŠ›å‡ºé”™è¯¯ï¼‰

âœ… **åº”è¯¥å¤„ç†å¼•æ“é…ç½®ä¿®æ”¹**
- æµ‹è¯•ä¿®æ”¹å¼•æ“é…ç½®
- éªŒè¯é…ç½®ä¿®æ”¹ç”Ÿæ•ˆ

âœ… **åº”è¯¥å¤„ç†è‡ªå®šä¹‰é…ç½®å­—æ®µ**
- æµ‹è¯•æ·»åŠ å’Œè®¿é—®è‡ªå®šä¹‰é…ç½®å­—æ®µ
- éªŒè¯é…ç½®ç³»ç»Ÿçš„çµæ´»æ€§

### 7. å¼•æ“åˆå§‹åŒ–é”™è¯¯ (3ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥å¤„ç†é‡å¤åˆå§‹åŒ–**
- æµ‹è¯•å¤šæ¬¡è°ƒç”¨ `init()` æ–¹æ³•
- éªŒè¯é‡å¤åˆå§‹åŒ–ä¸ä¼šæŠ›å‡ºé”™è¯¯

âœ… **åº”è¯¥å¤„ç†æ— æ•ˆçš„å¼•æ“é…ç½®**
- æµ‹è¯•ä¼ å…¥æ— æ•ˆé…ç½®ï¼ˆå¦‚ nullï¼‰
- éªŒè¯å¼•æ“èƒ½å¤Ÿå®¹é”™å¤„ç†

âœ… **åº”è¯¥å¤„ç†ç©ºé…ç½®å¯¹è±¡**
- æµ‹è¯•ä¼ å…¥ç©ºå¯¹è±¡ `{}`
- éªŒè¯ä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–

### 8. èµ„æºæ¸…ç†é”™è¯¯ (2ä¸ªæµ‹è¯•)

âœ… **åº”è¯¥å¤„ç†é”€æ¯æ—¶çš„é”™è¯¯**
- æµ‹è¯•å¼•æ“é”€æ¯æ—¶çš„é”™è¯¯å¤„ç†
- éªŒè¯é”€æ¯è¿‡ç¨‹å®Œæ•´æ‰§è¡Œ

âœ… **åº”è¯¥å¤„ç†å¤šæ¬¡é”€æ¯**
- æµ‹è¯•å¤šæ¬¡è°ƒç”¨ `destroy()` æ–¹æ³•
- éªŒè¯å¤šæ¬¡é”€æ¯ä¸ä¼šæŠ›å‡ºé”™è¯¯

## ğŸ” å…³é”®å‘ç°

### å¼•æ“çš„é”™è¯¯å¤„ç†ç­–ç•¥

1. **å®½å®¹ç­–ç•¥** (Permissive)
   - é‡å¤å®‰è£…æ’ä»¶ï¼šé™é»˜è·³è¿‡
   - è§¦å‘ä¸å­˜åœ¨çš„äº‹ä»¶ï¼šé™é»˜å¤±è´¥
   - ç©ºäº‹ä»¶å/çŠ¶æ€é”®ï¼šå…è®¸ä½¿ç”¨
   
2. **é”™è¯¯éš”ç¦»** (Error Isolation)
   - å•ä¸ªç›‘å¬å™¨é”™è¯¯ä¸å½±å“å…¶ä»–ç›‘å¬å™¨
   - ç”Ÿå‘½å‘¨æœŸé’©å­é”™è¯¯ä¸é˜»æ­¢å…¶ä»–é’©å­
   - æ’ä»¶é”™è¯¯ä¸å½±å“å¼•æ“çŠ¶æ€

3. **å†…éƒ¨æ—¥å¿—** (Internal Logging)
   - é”™è¯¯è®°å½•åˆ° console.error
   - ä¸å‘å¤–æŠ›å‡ºé”™è¯¯ï¼ˆexcept å®‰è£…/å¸è½½ï¼‰
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡

4. **å¼‚æ­¥é”™è¯¯å¤„ç†**
   - ä½¿ç”¨ try-catch æ•è·å¼‚æ­¥é”™è¯¯
   - é˜²æ­¢æœªå¤„ç†çš„ Promise rejection
   - æ”¯æŒå¼‚æ­¥æ’ä»¶å’Œé’©å­

## ğŸ“ˆ æµ‹è¯•è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯„çº§ |
|------|------|------|
| **æµ‹è¯•è¦†ç›–ç‡** | 100% | â­â­â­â­â­ |
| **è¾¹ç•Œåœºæ™¯è¦†ç›–** | å®Œæ•´ | â­â­â­â­â­ |
| **é”™è¯¯ç±»å‹å¤šæ ·æ€§** | 8ç§ | â­â­â­â­â­ |
| **ä»£ç è´¨é‡** | ä¼˜ç§€ | â­â­â­â­â­ |
| **æ–‡æ¡£å®Œæ•´æ€§** | è¯¦å°½ | â­â­â­â­â­ |

## ğŸ› ï¸ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½æ–­è¨€ç­–ç•¥

```typescript
// âŒ ä¸¥æ ¼ç­–ç•¥ï¼ˆä¸ç¬¦åˆå¼•æ“è¡Œä¸ºï¼‰
await expect(engine.use(plugin)).rejects.toThrow()

// âœ… å®½å®¹ç­–ç•¥ï¼ˆç¬¦åˆå®é™…è¡Œä¸ºï¼‰
await expect(engine.use(plugin)).resolves.not.toThrow()
```

### 2. å¼‚æ­¥é”™è¯¯æ•è·

```typescript
engine.events.on('test:async-error', async () => {
  try {
    await doSomethingAsync()
    throw new Error('Async error')
  } catch (error) {
    // é˜²æ­¢æœªå¤„ç†çš„ rejection
    console.error('Handled:', error)
  }
})
```

### 3. å‰¯ä½œç”¨éªŒè¯

```typescript
let errorCaught = false
engine.events.on('test:error', () => {
  errorCaught = true
  throw new Error('Expected error')
})
engine.events.emit('test:error')
expect(errorCaught).toBe(true) // éªŒè¯ä»£ç æ‰§è¡Œ
```

## ğŸ“ æµ‹è¯•æ‰§è¡Œæ—¥å¿—

```bash
âœ“ packages/core/tests/error-handling.test.ts (29 tests) 191ms

Test Files  1 passed (1)
Tests       29 passed (29)
Start at    12:50:34
Duration    1.69s (transform 219ms, setup 25ms, collect 244ms, tests 191ms)
```

## ğŸ“ ç»éªŒæ€»ç»“

### æµ‹è¯•ç¼–å†™ç­–ç•¥

1. **å…ˆç ”ç©¶ï¼Œåæµ‹è¯•** - é€šè¿‡æ—¥å¿—è¾“å‡ºç†è§£å®é™…è¡Œä¸º
2. **å®½æ¾æ–­è¨€** - ä½¿ç”¨ `not.toThrow()` è€Œé `toThrow()`
3. **å‰¯ä½œç”¨éªŒè¯** - é€šè¿‡æ ‡å¿—å˜é‡éªŒè¯ä»£ç æ‰§è¡Œ
4. **å¼‚æ­¥å¤„ç†** - ä½¿ç”¨ try-catch é˜²æ­¢æœªå¤„ç†çš„ rejection

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹ stderr** - é”™è¯¯ä¿¡æ¯åœ¨ stderr ä¸­
2. **åˆ†ææ—¥å¿—** - "already installed, skipping..." æç¤ºè¡Œä¸º
3. **é€æ­¥ä¿®å¤** - 8ä¸ªå¤±è´¥ â†’ 2ä¸ª â†’ 1ä¸ª â†’ 0ä¸ª
4. **ä¿æŒè€å¿ƒ** - å¤æ‚ç³»ç»Ÿéœ€è¦å¤šè½®è°ƒè¯•

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### å‰©ä½™è¾¹ç•Œåœºæ™¯æµ‹è¯•

1. **å¹¶å‘æµ‹è¯•** (concurrency.test.ts) - å¾…å¼€å§‹
   - å¹¶å‘æ’ä»¶å®‰è£…
   - å¹¶å‘äº‹ä»¶è§¦å‘
   - å¹¶å‘çŠ¶æ€æ›´æ–°
   - ç«æ€æ¡ä»¶å¤„ç†

2. **å†…å­˜æ³„æ¼æµ‹è¯•** (memory-leak.test.ts) - å¾…å¼€å§‹
   - äº‹ä»¶ç›‘å¬å™¨æ³„æ¼
   - çŠ¶æ€ç›‘å¬å™¨æ³„æ¼
   - æ’ä»¶å¸è½½åçš„èµ„æºæ¸…ç†
   - é•¿æ—¶é—´è¿è¡Œæµ‹è¯•

## ğŸ“Š ç´¯è®¡è¿›åº¦

| é˜¶æ®µ | å®Œæˆ | æ€»è®¡ | å®Œæˆç‡ |
|------|------|------|--------|
| Week 1 æ ¸å¿ƒæ¨¡å—æµ‹è¯• | 370 | 225 | 164.5% |
| Week 2 è¾¹ç•Œåœºæ™¯æµ‹è¯• | 29 | 87 | 33.3% |
| **æ€»è®¡** | **399** | **312** | **127.9%** |

---

**å®Œæˆæ—¶é—´**: 2025-11-25 12:50:36  
**æ‰§è¡Œè€…**: Roo  
**çŠ¶æ€**: âœ… å®Œæˆ  
**è´¨é‡è¯„çº§**: â­â­â­â­â­ (5/5)