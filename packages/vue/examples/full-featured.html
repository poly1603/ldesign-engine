<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue3 Engine - Full Featured Example</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .status.success {
      background: #10b981;
      color: white;
    }

    .status.error {
      background: #ef4444;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card h3 {
      color: #667eea;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn.secondary {
      background: #6b7280;
    }

    .btn.secondary:hover {
      background: #4b5563;
    }

    .btn.danger {
      background: #ef4444;
    }

    .btn.danger:hover {
      background: #dc2626;
    }

    .input {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      margin: 5px 0;
    }

    .list-item {
      background: #f9fafb;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      background: #667eea;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .metric {
      text-align: center;
      padding: 10px;
    }

    .metric-value {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
    }

    .metric-label {
      font-size: 12px;
      color: #6b7280;
      margin-top: 5px;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script type="module">
    import { createApp, ref, computed, reactive } from 'vue'
    import { createEngineApp } from '@ldesign/engine-vue3'
    import { useEngine, useEvents, useReactiveState } from '@ldesign/engine-vue3/composables'

    // å®Œæ•´åŠŸèƒ½çš„æ ¹ç»„ä»¶
    const App = {
      setup() {
        const engine = useEngine()
        const events = useEvents()

        // çŠ¶æ€
        const user = useReactiveState('user', { name: 'Guest', score: 0 })
        const tasks = useReactiveState('tasks', [])
        const newTaskTitle = ref('')

        // è®¡ç®—å±æ€§
        const stats = computed(() => ({
          total: tasks.value?.length || 0,
          completed: tasks.value?.filter(t => t.completed).length || 0,
          pending: tasks.value?.filter(t => !t.completed).length || 0
        }))

        const pluginStats = computed(() => engine.plugins.getStats())
        const cacheStats = computed(() => engine.cache.getStats())

        // æ–¹æ³•
        const addTask = () => {
          if (!newTaskTitle.value.trim()) return

          const task = {
            id: Date.now(),
            title: newTaskTitle.value,
            completed: false,
            createdAt: new Date()
          }

          tasks.value = [...(tasks.value || []), task]
          newTaskTitle.value = ''

          events.emit('task:created', task)
          user.value = { ...user.value, score: user.value.score + 10 }
        }

        const toggleTask = (taskId) => {
          tasks.value = tasks.value.map(t =>
            t.id === taskId ? { ...t, completed: !t.completed } : t
          )
          events.emit('task:toggled', taskId)
        }

        const deleteTask = (taskId) => {
          tasks.value = tasks.value.filter(t => t.id !== taskId)
          events.emit('task:deleted', taskId)
        }

        const testCache = () => {
          const key = 'test-' + Date.now()
          engine.cache.set(key, { data: 'cached value' }, 5000)
          engine.logger.info(`ç¼“å­˜å·²è®¾ç½®: ${key}`)

          setTimeout(() => {
            const value = engine.cache.get(key)
            engine.logger.info(`ç¼“å­˜è¯»å–:`, value)
          }, 100)
        }

        const testEvents = () => {
          events.emit('custom:event', {
            message: 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶',
            timestamp: Date.now()
          })
        }

        const clearCache = () => {
          engine.cache.clear()
          engine.logger.info('ç¼“å­˜å·²æ¸…ç©º')
        }

        // ç›‘å¬äº‹ä»¶
        events.on('task:created', (task) => {
          engine.logger.info('ä»»åŠ¡å·²åˆ›å»º:', task.title)
        })

        events.on('custom:event', (data) => {
          engine.logger.info('æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶:', data)
        })

        return {
          user,
          tasks,
          newTaskTitle,
          stats,
          pluginStats,
          cacheStats,
          addTask,
          toggleTask,
          deleteTask,
          testCache,
          testEvents,
          clearCache
        }
      },
      template: `
        <div class="app">
          <!-- å¤´éƒ¨ -->
          <div class="header">
            <h1>ğŸš€ Vue3 Engine - å®Œæ•´åŠŸèƒ½ç¤ºä¾‹</h1>
            <p style="margin: 10px 0;">
              <span class="status success">å¼•æ“å·²å°±ç»ª</span>
              <span class="badge">{{ pluginStats.installed }} ä¸ªæ’ä»¶</span>
              <span class="badge">{{ stats.total }} ä¸ªä»»åŠ¡</span>
            </p>
            <p style="color: #6b7280; font-size: 14px;">
              ç”¨æˆ·: <strong>{{ user.name }}</strong> | ç§¯åˆ†: <strong>{{ user.score }}</strong>
            </p>
          </div>
          
          <!-- ç»Ÿè®¡å¡ç‰‡ -->
          <div class="grid">
            <div class="card">
              <div style="display: flex; justify-content: space-around;">
                <div class="metric">
                  <div class="metric-value">{{ stats.total }}</div>
                  <div class="metric-label">æ€»ä»»åŠ¡</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ stats.completed }}</div>
                  <div class="metric-label">å·²å®Œæˆ</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ stats.pending }}</div>
                  <div class="metric-label">å¾…å¤„ç†</div>
                </div>
              </div>
            </div>
            
            <div class="card">
              <div style="display: flex; justify-content: space-around;">
                <div class="metric">
                  <div class="metric-value">{{ cacheStats.size }}</div>
                  <div class="metric-label">ç¼“å­˜é¡¹</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ cacheStats.hits }}</div>
                  <div class="metric-label">å‘½ä¸­æ¬¡æ•°</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ Math.round(cacheStats.hitRate * 100) }}%</div>
                  <div class="metric-label">å‘½ä¸­ç‡</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- åŠŸèƒ½åŒºåŸŸ -->
          <div class="grid">
            <!-- ä»»åŠ¡ç®¡ç† -->
            <div class="card">
              <h3>ğŸ“ ä»»åŠ¡ç®¡ç†</h3>
              <div>
                <input 
                  v-model="newTaskTitle" 
                  @keyup.enter="addTask"
                  class="input" 
                  placeholder="è¾“å…¥æ–°ä»»åŠ¡..." 
                />
                <button @click="addTask" class="btn">æ·»åŠ ä»»åŠ¡</button>
              </div>
              <div style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                <div v-for="task in tasks" :key="task.id" class="list-item">
                  <div>
                    <input 
                      type="checkbox" 
                      :checked="task.completed"
                      @change="toggleTask(task.id)"
                      style="margin-right: 10px;"
                    />
                    <span :style="{ textDecoration: task.completed ? 'line-through' : 'none' }">
                      {{ task.title }}
                    </span>
                  </div>
                  <button @click="deleteTask(task.id)" class="btn danger" style="padding: 5px 10px;">åˆ é™¤</button>
                </div>
                <div v-if="!tasks || tasks.length === 0" style="text-align: center; padding: 20px; color: #6b7280;">
                  æš‚æ— ä»»åŠ¡
                </div>
              </div>
            </div>
            
            <!-- å¼•æ“åŠŸèƒ½æµ‹è¯• -->
            <div class="card">
              <h3>âš™ï¸ å¼•æ“åŠŸèƒ½</h3>
              <div>
                <h4 style="margin: 10px 0; color: #6b7280;">ç¼“å­˜ç³»ç»Ÿ</h4>
                <button @click="testCache" class="btn">æµ‹è¯•ç¼“å­˜</button>
                <button @click="clearCache" class="btn secondary">æ¸…ç©ºç¼“å­˜</button>
                
                <h4 style="margin: 15px 0 10px; color: #6b7280;">äº‹ä»¶ç³»ç»Ÿ</h4>
                <button @click="testEvents" class="btn">è§¦å‘äº‹ä»¶</button>
                
                <h4 style="margin: 15px 0 10px; color: #6b7280;">æ’ä»¶ä¿¡æ¯</h4>
                <div class="list-item" v-for="name in pluginStats.loaded" :key="name">
                  {{ name }}
                </div>
              </div>
            </div>
          </div>
        </div>
      `
    }

    // åˆ›å»ºåº”ç”¨
    const engine = await createEngineApp({
      rootComponent: App,
      mountElement: '#app',
      config: {
        name: 'Full Featured Demo',
        version: '1.0.0',
        debug: true
      },
      cache: {
        maxSize: 100,
        defaultTTL: 300000
      },
      onReady: (engine) => {
        console.log('âœ… Engine ready!', engine.getStatus())
      }
    })

    window.engine = engine
    console.log('ğŸ’¡ æç¤º: ä½¿ç”¨ window.engine è®¿é—®å¼•æ“')
  </script>
</body>

</html>