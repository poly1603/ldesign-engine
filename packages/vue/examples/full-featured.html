<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue3 Engine - Full Featured Example</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .status.success {
      background: #10b981;
      color: white;
    }

    .status.error {
      background: #ef4444;
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card h3 {
      color: #667eea;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn.secondary {
      background: #6b7280;
    }

    .btn.secondary:hover {
      background: #4b5563;
    }

    .btn.danger {
      background: #ef4444;
    }

    .btn.danger:hover {
      background: #dc2626;
    }

    .input {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      margin: 5px 0;
    }

    .list-item {
      background: #f9fafb;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      background: #667eea;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .metric {
      text-align: center;
      padding: 10px;
    }

    .metric-value {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
    }

    .metric-label {
      font-size: 12px;
      color: #6b7280;
      margin-top: 5px;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script type="module">
    import { createApp, ref, computed, reactive } from 'vue'
    import { createEngineApp } from '@ldesign/engine-vue3'
    import { useEngine, useEvents, useReactiveState } from '@ldesign/engine-vue3/composables'

    // 完整功能的根组件
    const App = {
      setup() {
        const engine = useEngine()
        const events = useEvents()

        // 状态
        const user = useReactiveState('user', { name: 'Guest', score: 0 })
        const tasks = useReactiveState('tasks', [])
        const newTaskTitle = ref('')

        // 计算属性
        const stats = computed(() => ({
          total: tasks.value?.length || 0,
          completed: tasks.value?.filter(t => t.completed).length || 0,
          pending: tasks.value?.filter(t => !t.completed).length || 0
        }))

        const pluginStats = computed(() => engine.plugins.getStats())
        const cacheStats = computed(() => engine.cache.getStats())

        // 方法
        const addTask = () => {
          if (!newTaskTitle.value.trim()) return

          const task = {
            id: Date.now(),
            title: newTaskTitle.value,
            completed: false,
            createdAt: new Date()
          }

          tasks.value = [...(tasks.value || []), task]
          newTaskTitle.value = ''

          events.emit('task:created', task)
          user.value = { ...user.value, score: user.value.score + 10 }
        }

        const toggleTask = (taskId) => {
          tasks.value = tasks.value.map(t =>
            t.id === taskId ? { ...t, completed: !t.completed } : t
          )
          events.emit('task:toggled', taskId)
        }

        const deleteTask = (taskId) => {
          tasks.value = tasks.value.filter(t => t.id !== taskId)
          events.emit('task:deleted', taskId)
        }

        const testCache = () => {
          const key = 'test-' + Date.now()
          engine.cache.set(key, { data: 'cached value' }, 5000)
          engine.logger.info(`缓存已设置: ${key}`)

          setTimeout(() => {
            const value = engine.cache.get(key)
            engine.logger.info(`缓存读取:`, value)
          }, 100)
        }

        const testEvents = () => {
          events.emit('custom:event', {
            message: '这是一个自定义事件',
            timestamp: Date.now()
          })
        }

        const clearCache = () => {
          engine.cache.clear()
          engine.logger.info('缓存已清空')
        }

        // 监听事件
        events.on('task:created', (task) => {
          engine.logger.info('任务已创建:', task.title)
        })

        events.on('custom:event', (data) => {
          engine.logger.info('收到自定义事件:', data)
        })

        return {
          user,
          tasks,
          newTaskTitle,
          stats,
          pluginStats,
          cacheStats,
          addTask,
          toggleTask,
          deleteTask,
          testCache,
          testEvents,
          clearCache
        }
      },
      template: `
        <div class="app">
          <!-- 头部 -->
          <div class="header">
            <h1>🚀 Vue3 Engine - 完整功能示例</h1>
            <p style="margin: 10px 0;">
              <span class="status success">引擎已就绪</span>
              <span class="badge">{{ pluginStats.installed }} 个插件</span>
              <span class="badge">{{ stats.total }} 个任务</span>
            </p>
            <p style="color: #6b7280; font-size: 14px;">
              用户: <strong>{{ user.name }}</strong> | 积分: <strong>{{ user.score }}</strong>
            </p>
          </div>
          
          <!-- 统计卡片 -->
          <div class="grid">
            <div class="card">
              <div style="display: flex; justify-content: space-around;">
                <div class="metric">
                  <div class="metric-value">{{ stats.total }}</div>
                  <div class="metric-label">总任务</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ stats.completed }}</div>
                  <div class="metric-label">已完成</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ stats.pending }}</div>
                  <div class="metric-label">待处理</div>
                </div>
              </div>
            </div>
            
            <div class="card">
              <div style="display: flex; justify-content: space-around;">
                <div class="metric">
                  <div class="metric-value">{{ cacheStats.size }}</div>
                  <div class="metric-label">缓存项</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ cacheStats.hits }}</div>
                  <div class="metric-label">命中次数</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ Math.round(cacheStats.hitRate * 100) }}%</div>
                  <div class="metric-label">命中率</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 功能区域 -->
          <div class="grid">
            <!-- 任务管理 -->
            <div class="card">
              <h3>📝 任务管理</h3>
              <div>
                <input 
                  v-model="newTaskTitle" 
                  @keyup.enter="addTask"
                  class="input" 
                  placeholder="输入新任务..." 
                />
                <button @click="addTask" class="btn">添加任务</button>
              </div>
              <div style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                <div v-for="task in tasks" :key="task.id" class="list-item">
                  <div>
                    <input 
                      type="checkbox" 
                      :checked="task.completed"
                      @change="toggleTask(task.id)"
                      style="margin-right: 10px;"
                    />
                    <span :style="{ textDecoration: task.completed ? 'line-through' : 'none' }">
                      {{ task.title }}
                    </span>
                  </div>
                  <button @click="deleteTask(task.id)" class="btn danger" style="padding: 5px 10px;">删除</button>
                </div>
                <div v-if="!tasks || tasks.length === 0" style="text-align: center; padding: 20px; color: #6b7280;">
                  暂无任务
                </div>
              </div>
            </div>
            
            <!-- 引擎功能测试 -->
            <div class="card">
              <h3>⚙️ 引擎功能</h3>
              <div>
                <h4 style="margin: 10px 0; color: #6b7280;">缓存系统</h4>
                <button @click="testCache" class="btn">测试缓存</button>
                <button @click="clearCache" class="btn secondary">清空缓存</button>
                
                <h4 style="margin: 15px 0 10px; color: #6b7280;">事件系统</h4>
                <button @click="testEvents" class="btn">触发事件</button>
                
                <h4 style="margin: 15px 0 10px; color: #6b7280;">插件信息</h4>
                <div class="list-item" v-for="name in pluginStats.loaded" :key="name">
                  {{ name }}
                </div>
              </div>
            </div>
          </div>
        </div>
      `
    }

    // 创建应用
    const engine = await createEngineApp({
      rootComponent: App,
      mountElement: '#app',
      config: {
        name: 'Full Featured Demo',
        version: '1.0.0',
        debug: true
      },
      cache: {
        maxSize: 100,
        defaultTTL: 300000
      },
      onReady: (engine) => {
        console.log('✅ Engine ready!', engine.getStatus())
      }
    })

    window.engine = engine
    console.log('💡 提示: 使用 window.engine 访问引擎')
  </script>
</body>

</html>