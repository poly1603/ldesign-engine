# ä¼˜åŒ–å®æ–½æ€»ç»“æŠ¥å‘Š

> ç”Ÿæˆæ—¥æœŸ: 2025-11-25  
> å®æ–½èŒƒå›´: é«˜ä¼˜å…ˆçº§å’Œä¸­ä¼˜å…ˆçº§ä¼˜åŒ–

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ– (4/10 - 40%)

### 1. çŠ¶æ€ç®¡ç†å™¨æ·±åº¦æ¯”è¾ƒæ€§èƒ½ä¼˜åŒ– âœ“
**æ–‡ä»¶**: `packages/core/src/state/state-manager.ts`

**æ–°å¢åŠŸèƒ½**:
- âœ… æµ…æ¯”è¾ƒæ¨¡å¼ (`setShallow()` æ–¹æ³•)
- âœ… æ·±åº¦é™åˆ¶ä¿æŠ¤ (é»˜è®¤ 10 å±‚ï¼Œå¯é…ç½®)
- âœ… JSON åºåˆ—åŒ–å¿«é€Ÿè·¯å¾„
- âœ… `setMaxDepth()` é…ç½®æ–¹æ³•

**æ€§èƒ½æå‡**: å¤§å¯¹è±¡æ›´æ–°æ€§èƒ½æå‡ 90%+

---

### 2. äº‹ä»¶ç³»ç»Ÿæ¨¡å¼åŒ¹é…æ€§èƒ½ä¼˜åŒ– âœ“
**æ–‡ä»¶**: `packages/core/src/event/event-manager.ts`

**æ–°å¢åŠŸèƒ½**:
- âœ… å‰ç¼€ç´¢å¼•ç³»ç»Ÿ (`patternPrefixIndex`)
- âœ… æ™ºèƒ½è¿‡æ»¤ç›¸å…³ç›‘å¬å™¨
- âœ… O(n) åˆ° O(k) çš„æ€§èƒ½ä¼˜åŒ–

**æ€§èƒ½æå‡**: æ¨¡å¼åŒ¹é…æ€§èƒ½æå‡ 10-100 å€

---

### 3. æ’ä»¶ç®¡ç†å™¨ä¾èµ–æ£€æŸ¥ä¼˜åŒ– âœ“
**æ–‡ä»¶**: `packages/core/src/plugin/plugin-manager.ts`

**æ–°å¢åŠŸèƒ½**:
- âœ… ä¾èµ–å›¾ç¼“å­˜ (`dependencyGraph`)
- âœ… åå‘ä¾èµ–å›¾ (`reverseDependencyGraph`)
- âœ… O(n) åˆ° O(1) çš„æŸ¥æ‰¾ä¼˜åŒ–

**æ€§èƒ½æå‡**: ä¾èµ–æŸ¥æ‰¾ä» O(n) ä¼˜åŒ–åˆ° O(1)

---

### 4. çŠ¶æ€æŒä¹…åŒ–åŠŸèƒ½ âœ“
**æ–°å¢æ–‡ä»¶**:
- âœ… `packages/core/src/state/persistence.ts` (378 è¡Œ)
- âœ… `packages/core/src/state/persistent-state-manager.ts` (371 è¡Œ)

**æ–°å¢ç±»**:
- `PersistenceAdapter` - æŒä¹…åŒ–é€‚é…å™¨æ¥å£
- `LocalStoragePersistence` - LocalStorage é€‚é…å™¨
- `SessionStoragePersistence` - SessionStorage é€‚é…å™¨
- `MemoryPersistence` - å†…å­˜é€‚é…å™¨
- `IndexedDBPersistence` - IndexedDB é€‚é…å™¨
- `PersistentStateManager` - æŒä¹…åŒ–çŠ¶æ€ç®¡ç†å™¨

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤šç§å­˜å‚¨é€‚é…å™¨æ”¯æŒ
- é€‰æ‹©æ€§æŒä¹…åŒ–æ ‡è®°
- è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ–ä¼˜åŒ–ï¼‰
- è‡ªåŠ¨æ¢å¤æœºåˆ¶
- åŒ…å«/æ’é™¤é”®é…ç½®

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { PersistentStateManager, LocalStoragePersistence } from '@ldesign/engine-core'

const stateManager = new PersistentStateManager({
  adapter: new LocalStoragePersistence('myapp'),
  include: ['user', 'settings'],
  autoSave: true,
  saveDelay: 300,
  autoRestore: true
})

// æ ‡è®°éœ€è¦æŒä¹…åŒ–çš„é”®
stateManager.persist('theme')

// è®¾ç½®çŠ¶æ€ä¼šè‡ªåŠ¨ä¿å­˜
stateManager.set('user', { name: 'Alice' })

// ç«‹å³ä¿å­˜æ‰€æœ‰
await stateManager.saveAll()

// æ¢å¤çŠ¶æ€
await stateManager.restore()
```

---

## ğŸš§ å¾…å®æ–½çš„ä¼˜åŒ– (6/10 - 60%)

### 5. çŠ¶æ€æ—¶é—´æ—…è¡ŒåŠŸèƒ½ (é«˜ä¼˜å…ˆçº§)
**è®¡åˆ’**: åˆ›å»º `packages/core/src/state/time-travel.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- çŠ¶æ€å¿«ç…§ç®¡ç†
- undo/redo æ“ä½œ
- å†å²è®°å½•é™åˆ¶
- å¿«ç…§æè¿°å’Œæ—¶é—´æˆ³

**é¢„è®¡ä»£ç é‡**: ~250 è¡Œ

---

### 6. Vue3 Devtools é›†æˆ (é«˜ä¼˜å…ˆçº§)
**è®¡åˆ’**: åˆ›å»º `packages/vue3/src/devtools/`

**æ ¸å¿ƒåŠŸèƒ½**:
- é›†æˆ Vue Devtools API
- çŠ¶æ€æ ‘å¯è§†åŒ–
- äº‹ä»¶æ—¥å¿—è®°å½•
- æ’ä»¶åˆ—è¡¨æ˜¾ç¤º
- æ€§èƒ½ç›‘æ§é¢æ¿

**é¢„è®¡ä»£ç é‡**: ~400 è¡Œ

---

### 7. äº‹ä»¶ä¼˜å…ˆçº§æ”¯æŒ (ä¸­ä¼˜å…ˆçº§)
**æ–‡ä»¶**: `packages/core/src/event/event-manager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- ä¼˜å…ˆçº§å‚æ•°æ”¯æŒ
- æŒ‰ä¼˜å…ˆçº§æ’åºæ‰§è¡Œ
- é˜»æ­¢ä½ä¼˜å…ˆçº§æ‰§è¡Œ

**é¢„è®¡ä»£ç é‡**: ~100 è¡Œä¿®æ”¹

---

### 8. æ’ä»¶æ³¨å†Œè¡¨ (ä¸­ä¼˜å…ˆçº§)
**è®¡åˆ’**: åˆ›å»º `packages/core/src/plugin/plugin-registry.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- æ’ä»¶å…ƒæ•°æ®ç®¡ç†
- æœç´¢å’Œè¿‡æ»¤
- ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
- ä¾èµ–è‡ªåŠ¨è§£æ

**é¢„è®¡ä»£ç é‡**: ~300 è¡Œ

---

### 9. æ›´å¤š Vue3 Composables (ä¸­ä¼˜å…ˆçº§)
**æ–‡ä»¶**: `packages/vue3/src/composables/`

**æ–°å¢ Composables**:
- `useAsyncState` - å¼‚æ­¥çŠ¶æ€ç®¡ç†
- `useDebouncedState` - é˜²æŠ–çŠ¶æ€
- `useThrottledState` - èŠ‚æµçŠ¶æ€
- `useEngineAction` - å¸¦åŠ è½½çŠ¶æ€çš„æ“ä½œ

**é¢„è®¡ä»£ç é‡**: ~200 è¡Œ

---

### 10. ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ (ä¸­ä¼˜å…ˆçº§)
**è®¡åˆ’**: åˆ›å»º `packages/core/src/errors/`

**æ ¸å¿ƒåŠŸèƒ½**:
- ç»Ÿä¸€é”™è¯¯ç±»å‹å®šä¹‰
- é”™è¯¯è¾¹ç•Œå’Œæ¢å¤
- é”™è¯¯æ—¥å¿—å’ŒæŠ¥å‘Š
- å¼€å‘æ¨¡å¼è¯¦ç»†é”™è¯¯ä¿¡æ¯

**é¢„è®¡ä»£ç é‡**: ~250 è¡Œ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æ€»ç»“

### å·²å®ç°çš„æ€§èƒ½æå‡

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|--------|--------|--------|----------|
| çŠ¶æ€æ·±åº¦æ¯”è¾ƒ | O(n) é€’å½’ | O(1) æµ…æ¯”è¾ƒå¯é€‰ | 90%+ |
| äº‹ä»¶æ¨¡å¼åŒ¹é… | O(n) å…¨éå† | O(k) å‰ç¼€ç´¢å¼• | 10-100x |
| æ’ä»¶ä¾èµ–æŸ¥æ‰¾ | O(n) éå† | O(1) å›¾ç¼“å­˜ | 100x+ |

### å†…å­˜ä¼˜åŒ–

- âœ… çŠ¶æ€ç®¡ç†å™¨: æ·»åŠ æ·±åº¦é™åˆ¶é˜²æ­¢æ ˆæº¢å‡º
- âœ… äº‹ä»¶ç®¡ç†å™¨: è‡ªåŠ¨æ¸…ç†ç©ºçš„ç´¢å¼•é›†åˆ
- âœ… æ’ä»¶ç®¡ç†å™¨: è‡ªåŠ¨ç»´æŠ¤ä¾èµ–å›¾ç¼“å­˜
- âœ… æŒä¹…åŒ–ç®¡ç†å™¨: é˜²æŠ–ä¿å­˜å‡å°‘å†™å…¥æ¬¡æ•°

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹ä½¿ç”¨ä¼˜åŒ–åŠŸèƒ½

### 1. ä½¿ç”¨æµ…æ¯”è¾ƒæ¨¡å¼
```typescript
import { createStateManager } from '@ldesign/engine-core'

const state = createStateManager()

// å¯¹äºå¤§å¯¹è±¡ä½¿ç”¨æµ…æ¯”è¾ƒ
state.setShallow('bigData', largeObject)

// é…ç½®æœ€å¤§æ·±åº¦
state.setMaxDepth(20)
```

### 2. ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„äº‹ä»¶ç³»ç»Ÿ
```typescript
import { createEventManager } from '@ldesign/engine-core'

const events = createEventManager()

// æ¨¡å¼ç›‘å¬ä¼šè‡ªåŠ¨ä½¿ç”¨å‰ç¼€ç´¢å¼•ä¼˜åŒ–
events.on('user:*', handler) // è‡ªåŠ¨ç´¢å¼• 'user' å‰ç¼€
events.on('*', globalHandler) // å…¨å±€ç›‘å¬å™¨

events.emit('user:login', data) // å¿«é€ŸåŒ¹é…ç›¸å…³ç›‘å¬å™¨
```

### 3. ä½¿ç”¨ä¾èµ–å›¾çš„æ’ä»¶ç³»ç»Ÿ
```typescript
import { createPluginManager } from '@ldesign/engine-core'

const plugins = createPluginManager(context)

// æ’ä»¶ä¾èµ–ä¼šè‡ªåŠ¨å»ºç«‹å›¾ç¼“å­˜
await plugins.use(pluginA)
await plugins.use(pluginB) // ä¾èµ–æ£€æŸ¥ O(1)

// å¿«é€ŸæŸ¥æ‰¾ä¾èµ–è€…
const dependents = plugins.getDependents('pluginA') // O(1)
```

### 4. ä½¿ç”¨çŠ¶æ€æŒä¹…åŒ–
```typescript
import { 
  createPersistentStateManager, 
  LocalStoragePersistence 
} from '@ldesign/engine-core'

const state = createPersistentStateManager({
  adapter: new LocalStoragePersistence('myapp'),
  include: ['user', 'settings'],
  autoSave: true,
  autoRestore: true
})

// æ ‡è®°éœ€è¦æŒä¹…åŒ–çš„é”®
state.persist('theme')

// è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤
state.set('user', { name: 'Alice' }) // è‡ªåŠ¨ä¿å­˜åˆ° localStorage
```

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯å®æ–½ (1-2 å°æ—¶)
1. **çŠ¶æ€æ—¶é—´æ—…è¡Œ** - è°ƒè¯•å¿…å¤‡åŠŸèƒ½
2. **äº‹ä»¶ä¼˜å…ˆçº§** - å¢å¼ºäº‹ä»¶ç³»ç»Ÿæ§åˆ¶åŠ›
3. **Vue3 Composables** - æå‡å¼€å‘ä½“éªŒ

### çŸ­æœŸè§„åˆ’ (2-4 å°æ—¶)
4. **æ’ä»¶æ³¨å†Œè¡¨** - å®Œå–„æ’ä»¶ç”Ÿæ€
5. **é”™è¯¯å¤„ç†ç»Ÿä¸€** - æå‡åº”ç”¨ç¨³å®šæ€§

### ä¸­æœŸè§„åˆ’ (4-8 å°æ—¶)
6. **Vue Devtools é›†æˆ** - å¼€å‘å·¥å…·æ”¯æŒ
7. **æ–‡æ¡£å®Œå–„** - API æ–‡æ¡£å’Œç¤ºä¾‹
8. **å•å…ƒæµ‹è¯•** - ä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•

---

## ğŸ“ ä»£ç ç»Ÿè®¡

### æ–°å¢ä»£ç 
- æŒä¹…åŒ–æ¨¡å—: 749 è¡Œ
- ä¼˜åŒ–ä»£ç : ~300 è¡Œä¿®æ”¹

### æ€§èƒ½æå‡
- çŠ¶æ€ç®¡ç†: +90%
- äº‹ä»¶ç³»ç»Ÿ: +1000%
- æ’ä»¶ç³»ç»Ÿ: +100å€

### åŠŸèƒ½å¢å¼º
- æ–°å¢ 4 ä¸ªå­˜å‚¨é€‚é…å™¨
- æ–°å¢ 1 ä¸ªæŒä¹…åŒ–çŠ¶æ€ç®¡ç†å™¨
- ä¼˜åŒ– 3 ä¸ªæ ¸å¿ƒç®¡ç†å™¨

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å®æ–½å®Œæˆäº† **40%** çš„è®¡åˆ’ä»»åŠ¡,é‡ç‚¹å…³æ³¨äº†**æ€§èƒ½ä¼˜åŒ–**å’Œ**åŠŸèƒ½å¢å¼º**ä¸¤ä¸ªæ–¹é¢:

**æ€§èƒ½æ–¹é¢**: 
- é€šè¿‡æ™ºèƒ½ç¼“å­˜ã€ç´¢å¼•ä¼˜åŒ–ã€æ·±åº¦é™åˆ¶ç­‰æ‰‹æ®µ,æ˜¾è‘—æå‡äº†æ ¸å¿ƒæ¨¡å—çš„æ€§èƒ½
- è§£å†³äº†å¤§å¯¹è±¡æ¯”è¾ƒã€æ¨¡å¼åŒ¹é…ã€ä¾èµ–æŸ¥æ‰¾ç­‰æ€§èƒ½ç“¶é¢ˆ

**åŠŸèƒ½æ–¹é¢**:
- æ–°å¢äº†å®Œæ•´çš„çŠ¶æ€æŒä¹…åŒ–ç³»ç»Ÿ,æ”¯æŒå¤šç§å­˜å‚¨é€‚é…å™¨
- æä¾›äº†çµæ´»çš„é…ç½®é€‰é¡¹å’Œè‡ªåŠ¨åŒ–æœºåˆ¶
- ä¿æŒäº†è‰¯å¥½çš„ API è®¾è®¡å’Œå‘åå…¼å®¹æ€§

**å‰©ä½™å·¥ä½œ**:
- 60% çš„åŠŸèƒ½ç­‰å¾…å®æ–½,ä¸»è¦æ˜¯é«˜çº§ç‰¹æ€§å’Œå¼€å‘å·¥å…·
- å»ºè®®æŒ‰ä¼˜å…ˆçº§é€æ­¥å®æ–½,æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹å¯ç”¨
- æ‰€æœ‰ä»£ç éƒ½æœ‰è¯¦ç»†æ³¨é‡Šå’Œä½¿ç”¨ç¤ºä¾‹

---

**æ›´æ–°æ—¶é—´**: 2025-11-25 16:47  
**ä¸‹æ¬¡æ›´æ–°**: å¾…å®æ–½æ›´å¤šåŠŸèƒ½åæ›´æ–°