{"version":3,"file":"copy.js","sources":["../../../src/directives/modules/copy.ts"],"sourcesContent":["/**\r\n * 复制到剪贴板指令\r\n * 点击元素时复制指定内容到剪贴板\r\n */\r\n\r\nimport type { VueDirectiveBinding } from '../base/vue-directive-adapter'\r\nimport { DirectiveBase } from '../base/directive-base'\r\nimport { defineDirective, directiveUtils } from '../base/vue-directive-adapter'\r\n\r\nexport interface CopyOptions {\r\n  text?: string | (() => string)\r\n  onSuccess?: (text: string) => void\r\n  onError?: (error: Error) => void\r\n  disabled?: boolean\r\n  immediate?: boolean\r\n}\r\n\r\nexport class CopyDirective extends DirectiveBase {\r\n  constructor() {\r\n    super({\r\n      name: 'copy',\r\n      description: '点击复制内容到剪贴板',\r\n      version: '1.0.0',\r\n      category: 'interaction',\r\n      tags: ['copy', 'clipboard', 'interaction'],\r\n    })\r\n  }\r\n\r\n  public mounted(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    const config = this.parseConfig(binding)\r\n\r\n    const handleClick = async () => {\r\n      if (config.disabled) {\r\n        return\r\n      }\r\n\r\n      try {\r\n        const textToCopy = this.getText(config, el)\r\n        await this.copyToClipboard(textToCopy)\r\n\r\n        if (config.onSuccess) {\r\n          config.onSuccess(textToCopy)\r\n        }\r\n\r\n        this.log(`Copied to clipboard: ${textToCopy}`)\r\n      } catch (error) {\r\n        const err = error as Error\r\n        if (config.onError) {\r\n          config.onError(err)\r\n        }\r\n        this.warn(`Failed to copy: ${err.message}`)\r\n      }\r\n    }\r\n\r\n    // Store handler for cleanup\r\n    directiveUtils.storeData(el, 'copy-handler', handleClick)\r\n\r\n    // Add click listener\r\n    el.addEventListener('click', handleClick)\r\n\r\n    // Add cursor style\r\n    el.style.cursor = 'pointer'\r\n\r\n    // Execute immediately if specified\r\n    if (config.immediate) {\r\n      handleClick()\r\n    }\r\n\r\n    this.log(`Copy directive mounted on element`, el)\r\n  }\r\n\r\n  public updated(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    // Remove old handler\r\n    const oldHandler = directiveUtils.getData(el, 'copy-handler')\r\n    if (oldHandler) {\r\n      el.removeEventListener('click', oldHandler as EventListener)\r\n    }\r\n\r\n    // Re-mount with new config\r\n    this.mounted(el, binding)\r\n\r\n    this.log(`Copy directive updated on element`, el)\r\n  }\r\n\r\n  public unmounted(el: HTMLElement): void {\r\n    const handler = directiveUtils.getData(el, 'copy-handler')\r\n\r\n    if (handler) {\r\n      el.removeEventListener('click', handler as EventListener)\r\n      directiveUtils.removeData(el, 'copy-handler')\r\n    }\r\n\r\n    // Reset cursor style\r\n    el.style.cursor = ''\r\n\r\n    this.log(`Copy directive unmounted from element`, el)\r\n  }\r\n\r\n  private getText(config: CopyOptions, el: HTMLElement): string {\r\n    if (config.text) {\r\n      return typeof config.text === 'function' ? config.text() : config.text\r\n    }\r\n\r\n    // Try to get text from element\r\n    const input = el as HTMLInputElement\r\n    if (input.value !== undefined) {\r\n      return input.value\r\n    }\r\n\r\n    return el.textContent || ''\r\n  }\r\n\r\n  private async copyToClipboard(text: string): Promise<void> {\r\n    // Try modern Clipboard API first\r\n    if (navigator.clipboard && window.isSecureContext) {\r\n      await navigator.clipboard.writeText(text)\r\n      return\r\n    }\r\n\r\n    // Fallback to older method\r\n    const textarea = document.createElement('textarea')\r\n    textarea.value = text\r\n    textarea.style.position = 'fixed'\r\n    textarea.style.opacity = '0'\r\n    textarea.style.left = '-999999px'\r\n\r\n    document.body.appendChild(textarea)\r\n    textarea.select()\r\n\r\n    try {\r\n      const successful = document.execCommand('copy')\r\n      if (!successful) {\r\n        throw new Error('Copy command failed')\r\n      }\r\n    } finally {\r\n      document.body.removeChild(textarea)\r\n    }\r\n  }\r\n\r\n  private parseConfig(binding: VueDirectiveBinding): CopyOptions {\r\n    const value = binding.value\r\n\r\n    if (typeof value === 'string') {\r\n      return { text: value }\r\n    }\r\n\r\n    if (typeof value === 'function') {\r\n      return { text: value as () => string }\r\n    }\r\n\r\n    if (typeof value === 'object' && value !== null) {\r\n      return value as CopyOptions\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  public getExample(): string {\r\n    return `\r\n<!-- Copy static text -->\r\n<button v-copy=\"'Hello, World!'\">\r\n  Copy Text\r\n</button>\r\n\r\n<!-- Copy from element content -->\r\n<div v-copy>\r\n  This content will be copied\r\n</div>\r\n\r\n<!-- Copy from input value -->\r\n<input v-copy value=\"Copy this value\" />\r\n\r\n<!-- With options -->\r\n<button v-copy=\"{\r\n  text: 'Custom text to copy',\r\n  onSuccess: (text) => ,\r\n  onError: (error) => console.error('Failed:', error),\r\n  disabled: false\r\n}\">\r\n  Copy with Options\r\n</button>\r\n\r\n<!-- Dynamic text -->\r\n<button v-copy=\"{\r\n  text: () => new Date().toISOString(),\r\n  onSuccess: () => showToast('Copied!')\r\n}\">\r\n  Copy Current Time\r\n</button>\r\n    `\r\n  }\r\n}\r\n\r\n// Export the directive definition\r\nexport const vCopy = defineDirective(new CopyDirective())\r\n\r\n// Export default for convenience\r\nexport default vCopy\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAiBM,MAAO,sBAAsB,aAAA,CAAa;AAAA,EAC9C,WAAA,GAAA;AACE,IAAA,KAAA,CAAM;AAAA,MACJ,IAAA,EAAM,MAAA;AAAA,MACN,WAAA,EAAa,8DAAA;AAAA,MACb,OAAA,EAAS,OAAA;AAAA,MACT,QAAA,EAAU,aAAA;AAAA,MACV,IAAA,EAAM,CAAC,MAAA,EAAQ,WAAA,EAAa,aAAa;AAAA,KAC1C,CAAA;AAAA,EACH;AAAA,EAEO,OAAA,CAAQ,IAAiB,OAAA,EAA4B;AAC1D,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,WAAA,CAAY,OAAO,CAAA;AAEvC,IAAA,MAAM,cAAc,YAAW;AAC7B,MAAA,IAAI,OAAO,QAAA,EAAU;AACnB,QAAA;AAAA,MACF;AAEA,MAAA,IAAI;AACF,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,EAAE,CAAA;AAC1C,QAAA,MAAM,IAAA,CAAK,gBAAgB,UAAU,CAAA;AAErC,QAAA,IAAI,OAAO,SAAA,EAAW;AACpB,UAAA,MAAA,CAAO,UAAU,UAAU,CAAA;AAAA,QAC7B;AAEA,QAAA,IAAA,CAAK,GAAA,CAAI,CAAA,qBAAA,EAAwB,UAAU,CAAA,CAAE,CAAA;AAAA,MAC/C,SAAS,KAAA,EAAO;AACd,QAAA,MAAM,GAAA,GAAM,KAAA;AACZ,QAAA,IAAI,OAAO,OAAA,EAAS;AAClB,UAAA,MAAA,CAAO,QAAQ,GAAG,CAAA;AAAA,QACpB;AACA,QAAA,IAAA,CAAK,IAAA,CAAK,CAAA,gBAAA,EAAmB,GAAA,CAAI,OAAO,CAAA,CAAE,CAAA;AAAA,MAC5C;AAAA,IACF,CAAA;AAGA,IAAA,cAAA,CAAe,SAAA,CAAU,EAAA,EAAI,cAAA,EAAgB,WAAW,CAAA;AAGxD,IAAA,EAAA,CAAG,gBAAA,CAAiB,SAAS,WAAW,CAAA;AAGxC,IAAA,EAAA,CAAG,MAAM,MAAA,GAAS,SAAA;AAGlB,IAAA,IAAI,OAAO,SAAA,EAAW;AACpB,MAAA,WAAA;IACF;AAEA,IAAA,IAAA,CAAK,GAAA,CAAI,qCAAqC,EAAE,CAAA;AAAA,EAClD;AAAA,EAEO,OAAA,CAAQ,IAAiB,OAAA,EAA4B;AAE1D,IAAA,MAAM,UAAA,GAAa,cAAA,CAAe,OAAA,CAAQ,EAAA,EAAI,cAAc,CAAA;AAC5D,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,EAAA,CAAG,mBAAA,CAAoB,SAAS,UAA2B,CAAA;AAAA,IAC7D;AAGA,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAI,OAAO,CAAA;AAExB,IAAA,IAAA,CAAK,GAAA,CAAI,qCAAqC,EAAE,CAAA;AAAA,EAClD;AAAA,EAEO,UAAU,EAAA,EAAe;AAC9B,IAAA,MAAM,OAAA,GAAU,cAAA,CAAe,OAAA,CAAQ,EAAA,EAAI,cAAc,CAAA;AAEzD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,EAAA,CAAG,mBAAA,CAAoB,SAAS,OAAwB,CAAA;AACxD,MAAA,cAAA,CAAe,UAAA,CAAW,IAAI,cAAc,CAAA;AAAA,IAC9C;AAGA,IAAA,EAAA,CAAG,MAAM,MAAA,GAAS,EAAA;AAElB,IAAA,IAAA,CAAK,GAAA,CAAI,yCAAyC,EAAE,CAAA;AAAA,EACtD;AAAA,EAEQ,OAAA,CAAQ,QAAqB,EAAA,EAAe;AAClD,IAAA,IAAI,OAAO,IAAA,EAAM;AACf,MAAA,OAAO,OAAO,MAAA,CAAO,IAAA,KAAS,aAAa,MAAA,CAAO,IAAA,KAAS,MAAA,CAAO,IAAA;AAAA,IACpE;AAGA,IAAA,MAAM,KAAA,GAAQ,EAAA;AACd,IAAA,IAAI,KAAA,CAAM,UAAU,MAAA,EAAW;AAC7B,MAAA,OAAO,KAAA,CAAM,KAAA;AAAA,IACf;AAEA,IAAA,OAAO,GAAG,WAAA,IAAe,EAAA;AAAA,EAC3B;AAAA,EAEQ,MAAM,gBAAgB,IAAA,EAAY;AAExC,IAAA,IAAI,SAAA,CAAU,SAAA,IAAa,MAAA,CAAO,eAAA,EAAiB;AACjD,MAAA,MAAM,SAAA,CAAU,SAAA,CAAU,SAAA,CAAU,IAAI,CAAA;AACxC,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,QAAA,GAAW,QAAA,CAAS,aAAA,CAAc,UAAU,CAAA;AAClD,IAAA,QAAA,CAAS,KAAA,GAAQ,IAAA;AACjB,IAAA,QAAA,CAAS,MAAM,QAAA,GAAW,OAAA;AAC1B,IAAA,QAAA,CAAS,MAAM,OAAA,GAAU,GAAA;AACzB,IAAA,QAAA,CAAS,MAAM,IAAA,GAAO,WAAA;AAEtB,IAAA,QAAA,CAAS,IAAA,CAAK,YAAY,QAAQ,CAAA;AAClC,IAAA,QAAA,CAAS,MAAA,EAAM;AAEf,IAAA,IAAI;AACF,MAAA,MAAM,UAAA,GAAa,QAAA,CAAS,WAAA,CAAY,MAAM,CAAA;AAC9C,MAAA,IAAI,CAAC,UAAA,EAAY;AACf,QAAA,MAAM,IAAI,MAAM,qBAAqB,CAAA;AAAA,MACvC;AAAA,IACF,CAAA;AACE,MAAA,QAAA,CAAS,IAAA,CAAK,YAAY,QAAQ,CAAA;AAAA,IACpC;AAAA,EACF;AAAA,EAEQ,YAAY,OAAA,EAA4B;AAC9C,IAAA,MAAM,QAAQ,OAAA,CAAQ,KAAA;AAEtB,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO,EAAE,MAAM,KAAA;IACjB;AAEA,IAAA,IAAI,OAAO,UAAU,UAAA,EAAY;AAC/B,MAAA,OAAO,EAAE,MAAM,KAAA;IACjB;AAEA,IAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,IAAA,EAAM;AAC/C,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,OAAO;EACT;AAAA,EAEO,UAAA,GAAU;AACf,IAAA,OAAO;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAAA,EAgCT;AACD;AAGM,MAAM,KAAA,GAAQ,eAAA,CAAgB,IAAI,aAAA,EAAe;;;;"}