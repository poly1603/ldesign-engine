{"version":3,"file":"click-outside.cjs","sources":["../../../src/directives/modules/click-outside.ts"],"sourcesContent":["/**\r\n * 点击外部区域指令\r\n * 当用户点击元素外部时触发回调\r\n */\r\n\r\nimport type { VueDirectiveBinding } from '../base/vue-directive-adapter'\r\nimport { DirectiveBase } from '../base/directive-base'\r\nimport { defineDirective, directiveUtils } from '../base/vue-directive-adapter'\r\n\r\nexport interface ClickOutsideOptions {\r\n  handler?: (event: Event) => void\r\n  exclude?: string[] | HTMLElement[]\r\n  capture?: boolean\r\n  disabled?: boolean\r\n}\r\n\r\nexport class ClickOutsideDirective extends DirectiveBase {\r\n  private documentHandler: ((e: Event) => void) | null = null\r\n\r\n  constructor() {\r\n    super({\r\n      name: 'click-outside',\r\n      description: '点击元素外部时触发回调',\r\n      version: '1.0.0',\r\n      category: 'interaction',\r\n      tags: ['click', 'outside', 'interaction'],\r\n    })\r\n  }\r\n\r\n  public mounted(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    const config = this.parseConfig(binding)\r\n\r\n    if (!config.handler || typeof config.handler !== 'function') {\r\n      this.warn('click-outside directive requires a handler function')\r\n      return\r\n    }\r\n\r\n    const handler = (event: Event) => {\r\n      if (config.disabled) {\r\n        return\r\n      }\r\n\r\n      const target = event.target as Node\r\n\r\n      // Check if click is inside the element\r\n      if (el.contains(target)) {\r\n        return\r\n      }\r\n\r\n      // Check excluded elements\r\n      if (config.exclude && config.exclude.length > 0) {\r\n        const isExcluded = config.exclude.some((item) => {\r\n          if (typeof item === 'string') {\r\n            const excludeEl = document.querySelector(item)\r\n            return excludeEl && excludeEl.contains(target)\r\n          } else if (item instanceof HTMLElement) {\r\n            return item.contains(target)\r\n          }\r\n          return false\r\n        })\r\n\r\n        if (isExcluded) {\r\n          return\r\n        }\r\n      }\r\n\r\n      // Trigger the handler\r\n      if (config.handler) {\r\n        config.handler(event)\r\n      }\r\n    }\r\n\r\n    // Store handler for cleanup\r\n    this.documentHandler = handler\r\n    directiveUtils.storeData(el, 'click-outside-handler', handler)\r\n\r\n    // Add event listener\r\n    document.addEventListener('click', handler, config.capture ?? true)\r\n\r\n    this.log(`Directive mounted on element`, el)\r\n  }\r\n\r\n  public updated(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    const oldHandler = directiveUtils.getData(el, 'click-outside-handler')\r\n\r\n    // Remove old handler if exists\r\n    if (oldHandler) {\r\n      document.removeEventListener('click', oldHandler as EventListener, true)\r\n      document.removeEventListener('click', oldHandler as EventListener, false)\r\n    }\r\n\r\n    // Mount new handler\r\n    this.mounted(el, binding)\r\n\r\n    this.log(`Directive updated on element`, el)\r\n  }\r\n\r\n  public unmounted(el: HTMLElement): void {\r\n    const handler = directiveUtils.getData(el, 'click-outside-handler')\r\n\r\n    if (handler) {\r\n      document.removeEventListener('click', handler as EventListener, true)\r\n      document.removeEventListener('click', handler as EventListener, false)\r\n      directiveUtils.removeData(el, 'click-outside-handler')\r\n    }\r\n\r\n    this.documentHandler = null\r\n    this.log(`Directive unmounted from element`, el)\r\n  }\r\n\r\n  private parseConfig(binding: VueDirectiveBinding): ClickOutsideOptions {\r\n    const value = binding.value\r\n\r\n    // Handle different binding formats\r\n    if (typeof value === 'function') {\r\n      return { handler: value as (event: Event) => void }\r\n    }\r\n\r\n    if (typeof value === 'object' && value !== null) {\r\n      const v = value as Partial<ClickOutsideOptions>\r\n      return {\r\n        handler: v.handler as (event: Event) => void,\r\n        exclude: v.exclude,\r\n        capture: v.capture,\r\n        disabled: v.disabled,\r\n      }\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  public getExample(): string {\r\n    return `\r\n<!-- Basic usage -->\r\n<div v-click-outside=\"handleClickOutside\">\r\n  Click outside me\r\n</div>\r\n\r\n<!-- With options -->\r\n<div v-click-outside=\"{\r\n  handler: handleClickOutside,\r\n  exclude: ['.modal', '#dropdown'],\r\n  capture: true,\r\n  disabled: false\r\n}\">\r\n  Advanced click outside\r\n</div>\r\n\r\n<script setup>\r\nconst handleClickOutside = (event) => {\r\n  \r\n  // Close dropdown, modal, etc.\r\n}\r\n</script>\r\n    `\r\n  }\r\n}\r\n\r\n// Export the directive definition\r\nexport const vClickOutside = defineDirective(new ClickOutsideDirective())\r\n\r\n// Export default for convenience\r\nexport default vClickOutside\r\n"],"names":["DirectiveBase","directiveUtils","defineDirective"],"mappings":"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"}