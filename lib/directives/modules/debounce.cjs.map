{"version":3,"file":"debounce.cjs","sources":["../../../src/directives/modules/debounce.ts"],"sourcesContent":["/**\r\n * 防抖指令\r\n * 防止事件频繁触发，在指定时间内只执行最后一次\r\n */\r\n\r\nimport type { VueDirectiveBinding } from '../base/vue-directive-adapter'\r\nimport { DirectiveBase } from '../base/directive-base'\r\nimport { defineDirective, directiveUtils } from '../base/vue-directive-adapter'\r\n\r\nexport interface DebounceOptions {\r\n  handler?: (...args: unknown[]) => void\r\n  delay?: number\r\n  event?: string\r\n  immediate?: boolean\r\n  disabled?: boolean\r\n}\r\n\r\nexport class DebounceDirective extends DirectiveBase {\r\n  constructor() {\r\n    super({\r\n      name: 'debounce',\r\n      description: '防抖处理，避免频繁触发',\r\n      version: '1.0.0',\r\n      category: 'performance',\r\n      tags: ['debounce', 'throttle', 'performance', 'event'],\r\n    })\r\n  }\r\n\r\n  public mounted(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    const config = this.parseConfig(binding)\r\n\r\n    if (!config.handler || typeof config.handler !== 'function') {\r\n      this.warn('Debounce directive requires a handler function')\r\n      return\r\n    }\r\n\r\n    const delay = config.delay ?? 300\r\n    const event = config.event ?? 'click'\r\n    const immediate = config.immediate ?? false\r\n\r\n    let timeoutId: NodeJS.Timeout | null = null\r\n\r\n    const debouncedHandler = (...args: unknown[]) => {\r\n      if (config.disabled) {\r\n        return\r\n      }\r\n\r\n      const later = () => {\r\n        timeoutId = null\r\n        if (!immediate && config.handler) {\r\n          config.handler(...args)\r\n          this.log(`Debounced event triggered after ${delay}ms`)\r\n        }\r\n      }\r\n\r\n      const callNow = immediate && !timeoutId\r\n\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId)\r\n      }\r\n\r\n      timeoutId = setTimeout(later, delay)\r\n\r\n      if (callNow && config.handler) {\r\n        config.handler(...args)\r\n        this.log(`Immediate debounced event triggered`)\r\n      }\r\n    }\r\n\r\n    // Store handlers and config for cleanup\r\n    directiveUtils.storeData(el, 'debounce-handler', debouncedHandler)\r\n    directiveUtils.storeData(el, 'debounce-event', event)\r\n    directiveUtils.storeData(el, 'debounce-timeout', timeoutId)\r\n\r\n    // Add event listener\r\n    el.addEventListener(event, debouncedHandler)\r\n\r\n    this.log(`Debounce directive mounted on element with ${delay}ms delay`, el)\r\n  }\r\n\r\n  public updated(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    // Clean up old handler\r\n    const oldHandler = directiveUtils.getData(el, 'debounce-handler')\r\n    const oldEvent = directiveUtils.getData(el, 'debounce-event')\r\n    const oldTimeout = directiveUtils.getData(el, 'debounce-timeout')\r\n\r\n    if (oldHandler && oldEvent) {\r\n      el.removeEventListener(oldEvent as string, oldHandler as EventListener)\r\n    }\r\n\r\n    if (oldTimeout) {\r\n      clearTimeout(oldTimeout as NodeJS.Timeout)\r\n    }\r\n\r\n    // Re-mount with new config\r\n    this.mounted(el, binding)\r\n\r\n    this.log(`Debounce directive updated on element`, el)\r\n  }\r\n\r\n  public unmounted(el: HTMLElement): void {\r\n    const handler = directiveUtils.getData(el, 'debounce-handler')\r\n    const event = directiveUtils.getData(el, 'debounce-event')\r\n    const timeout = directiveUtils.getData(el, 'debounce-timeout')\r\n\r\n    if (handler && event) {\r\n      el.removeEventListener(event as string, handler as EventListener)\r\n    }\r\n\r\n    if (timeout) {\r\n      clearTimeout(timeout as NodeJS.Timeout)\r\n    }\r\n\r\n    directiveUtils.removeData(el, 'debounce-handler')\r\n    directiveUtils.removeData(el, 'debounce-event')\r\n    directiveUtils.removeData(el, 'debounce-timeout')\r\n\r\n    this.log(`Debounce directive unmounted from element`, el)\r\n  }\r\n\r\n  private parseConfig(binding: VueDirectiveBinding): DebounceOptions {\r\n    const value = binding.value\r\n\r\n    // Handle function as handler\r\n    if (typeof value === 'function') {\r\n      return { handler: value as (...args: unknown[]) => void }\r\n    }\r\n\r\n    // Handle object config\r\n    if (typeof value === 'object' && value !== null) {\r\n      return value as DebounceOptions\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  public getExample(): string {\r\n    return `\r\n<!-- Basic debounce with default 300ms delay -->\r\n<input v-debounce=\"handleSearch\" placeholder=\"Search...\">\r\n\r\n<!-- Custom delay -->\r\n<button v-debounce=\"{\r\n  handler: handleClick,\r\n  delay: 500\r\n}\">\r\n  Debounced Click (500ms)\r\n</button>\r\n\r\n<!-- Different event -->\r\n<input v-debounce=\"{\r\n  handler: handleInput,\r\n  event: 'input',\r\n  delay: 300\r\n}\" placeholder=\"Type something...\">\r\n\r\n<!-- Immediate mode (triggers on leading edge) -->\r\n<button v-debounce=\"{\r\n  handler: saveData,\r\n  delay: 1000,\r\n  immediate: true\r\n}\">\r\n  Save (immediate)\r\n</button>\r\n\r\n<!-- Conditional debounce -->\r\n<button v-debounce=\"{\r\n  handler: submitForm,\r\n  delay: 500,\r\n  disabled: isSubmitting\r\n}\">\r\n  Submit\r\n</button>\r\n\r\n<script setup>\r\nconst handleSearch = (event) => {\r\n  \r\n}\r\n\r\nconst handleClick = () => {\r\n  \r\n}\r\n\r\nconst handleInput = (event) => {\r\n  \r\n}\r\n\r\nconst saveData = () => {\r\n  \r\n}\r\n\r\nconst submitForm = () => {\r\n  \r\n}\r\n</script>\r\n    `\r\n  }\r\n}\r\n\r\n// Export the directive definition\r\nexport const vDebounce = defineDirective(new DebounceDirective())\r\n\r\n// Export default for convenience\r\nexport default vDebounce\r\n"],"names":["DirectiveBase","directiveUtils","defineDirective"],"mappings":"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"}