{"version":3,"file":"throttle.cjs","sources":["../../../src/directives/modules/throttle.ts"],"sourcesContent":["/**\r\n * 节流指令\r\n * 限制事件触发频率，在指定时间内最多执行一次\r\n */\r\n\r\nimport type { VueDirectiveBinding } from '../base/vue-directive-adapter'\r\nimport { DirectiveBase } from '../base/directive-base'\r\nimport { defineDirective, directiveUtils } from '../base/vue-directive-adapter'\r\n\r\nexport interface ThrottleOptions {\r\n  handler?: (...args: unknown[]) => void\r\n  delay?: number\r\n  event?: string\r\n  disabled?: boolean\r\n  leading?: boolean\r\n  trailing?: boolean\r\n}\r\n\r\nexport class ThrottleDirective extends DirectiveBase {\r\n  constructor() {\r\n    super({\r\n      name: 'throttle',\r\n      description: '节流处理，限制触发频率',\r\n      version: '1.0.0',\r\n      category: 'performance',\r\n      tags: ['throttle', 'performance', 'event'],\r\n    })\r\n  }\r\n\r\n  public mounted(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    const config = this.parseConfig(binding)\r\n\r\n    if (!config.handler || typeof config.handler !== 'function') {\r\n      this.warn('Throttle directive requires a handler function')\r\n      return\r\n    }\r\n\r\n    const delay = config.delay ?? 200\r\n    const event = config.event ?? 'click'\r\n    const leading = config.leading ?? true\r\n    const trailing = config.trailing ?? true\r\n\r\n    let lastTime = 0\r\n    let timeoutId: NodeJS.Timeout | null = null\r\n    let lastArgs: unknown[] = []\r\n\r\n    const throttledHandler = (...args: unknown[]) => {\r\n      if (config.disabled) return\r\n\r\n      const now = Date.now()\r\n      const remaining = delay - (now - lastTime)\r\n\r\n      lastArgs = args\r\n\r\n      const execute = () => {\r\n        if (config.handler) {\r\n          config.handler(...lastArgs)\r\n        }\r\n        lastTime = Date.now()\r\n        timeoutId = null\r\n      }\r\n\r\n      if (remaining <= 0 || remaining > delay) {\r\n        // If leading is enabled and enough time has passed\r\n        if (timeoutId) {\r\n          clearTimeout(timeoutId)\r\n          timeoutId = null\r\n        }\r\n\r\n        if (leading) {\r\n          execute()\r\n        } else {\r\n          lastTime = now\r\n        }\r\n\r\n        if (trailing && !timeoutId) {\r\n          timeoutId = setTimeout(() => {\r\n            execute()\r\n          }, delay)\r\n        }\r\n      } else if (!timeoutId && trailing) {\r\n        // Schedule trailing execution\r\n        timeoutId = setTimeout(() => {\r\n          execute()\r\n        }, remaining)\r\n      }\r\n    }\r\n\r\n    // Store handlers and config for cleanup\r\n    directiveUtils.storeData(el, 'throttle-handler', throttledHandler)\r\n    directiveUtils.storeData(el, 'throttle-event', event)\r\n    directiveUtils.storeData(el, 'throttle-timeout', timeoutId)\r\n\r\n    // Add event listener\r\n    el.addEventListener(event, throttledHandler)\r\n\r\n    this.log(`Throttle directive mounted on element with ${delay}ms delay`, el)\r\n  }\r\n\r\n  public updated(el: HTMLElement, binding: VueDirectiveBinding): void {\r\n    // Clean up old handler\r\n    const oldHandler = directiveUtils.getData(el, 'throttle-handler')\r\n    const oldEvent = directiveUtils.getData(el, 'throttle-event')\r\n    const oldTimeout = directiveUtils.getData(el, 'throttle-timeout')\r\n\r\n    if (oldHandler && oldEvent) {\r\n      el.removeEventListener(oldEvent as string, oldHandler as EventListener)\r\n    }\r\n\r\n    if (oldTimeout) {\r\n      clearTimeout(oldTimeout as NodeJS.Timeout)\r\n    }\r\n\r\n    // Re-mount with new config\r\n    this.mounted(el, binding)\r\n\r\n    this.log(`Throttle directive updated on element`, el)\r\n  }\r\n\r\n  public unmounted(el: HTMLElement): void {\r\n    const handler = directiveUtils.getData(el, 'throttle-handler')\r\n    const event = directiveUtils.getData(el, 'throttle-event')\r\n    const timeout = directiveUtils.getData(el, 'throttle-timeout')\r\n\r\n    if (handler && event) {\r\n      el.removeEventListener(event as string, handler as EventListener)\r\n    }\r\n\r\n    if (timeout) {\r\n      clearTimeout(timeout as NodeJS.Timeout)\r\n    }\r\n\r\n    directiveUtils.removeData(el, 'throttle-handler')\r\n    directiveUtils.removeData(el, 'throttle-event')\r\n    directiveUtils.removeData(el, 'throttle-timeout')\r\n\r\n    this.log(`Throttle directive unmounted from element`, el)\r\n  }\r\n\r\n  private parseConfig(binding: VueDirectiveBinding): ThrottleOptions {\r\n    const value = binding.value\r\n\r\n    // Handle function as handler\r\n    if (typeof value === 'function') {\r\n      return { handler: value as (...args: unknown[]) => void }\r\n    }\r\n\r\n    // Handle object config\r\n    if (typeof value === 'object' && value !== null) {\r\n      return value as ThrottleOptions\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  public getExample(): string {\r\n    return `\r\n<!-- Basic throttle with default 200ms delay -->\r\n<button v-throttle=\"handleClick\">\r\n  Throttled Click\r\n</button>\r\n\r\n<!-- Custom delay -->\r\n<div v-throttle=\"{\r\n  handler: handleScroll,\r\n  event: 'scroll',\r\n  delay: 500\r\n}\" class=\"scrollable\">\r\n  Scroll me (throttled)\r\n</div>\r\n\r\n<!-- Leading and trailing options -->\r\n<button v-throttle=\"{\r\n  handler: handleInput,\r\n  delay: 300,\r\n  leading: false,\r\n  trailing: true\r\n}\">\r\n  Trailing only\r\n</button>\r\n\r\n<!-- Different event -->\r\n<input v-throttle=\"{\r\n  handler: handleKeyPress,\r\n  event: 'keydown',\r\n  delay: 100\r\n}\" placeholder=\"Type here (throttled)\">\r\n\r\n<!-- Conditional throttle -->\r\n<button v-throttle=\"{\r\n  handler: saveProgress,\r\n  delay: 1000,\r\n  disabled: isSaving\r\n}\">\r\n  Auto-save\r\n</button>\r\n\r\n<script setup>\r\nconst handleClick = () => {\r\n  ')\r\n}\r\n\r\nconst handleScroll = (event) => {\r\n  \r\n}\r\n\r\nconst handleInput = () => {\r\n  ')\r\n}\r\n\r\nconst handleKeyPress = (event) => {\r\n  \r\n}\r\n\r\nconst saveProgress = () => {\r\n  \r\n}\r\n</script>\r\n    `\r\n  }\r\n}\r\n\r\n// Export the directive definition\r\nexport const vThrottle = defineDirective(new ThrottleDirective())\r\n\r\n// Export default for convenience\r\nexport default vThrottle\r\n"],"names":["DirectiveBase","directiveUtils","defineDirective"],"mappings":"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"}